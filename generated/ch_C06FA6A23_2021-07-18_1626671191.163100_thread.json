{
  "id": "ch_C06FA6A23_2021-07-18_1626671191.163100_thread",
  "type": "channel",
  "channel_name": "discuss-engineering",
  "conversation_type": "thread",
  "participants": [
    "Gunjan",
    "sudeep",
    "vineeth",
    "Naveen",
    "shaunak",
    "Rakesh"
  ],
  "messages": [
    {
      "sender": "Gunjan",
      "user_id": "U01V29NME2Y",
      "message": "<!here> We are in the middle of JPMC training and candidates are seeing a lot of slowness on prod. Can someone check why this is happening",
      "time": "22:06",
      "timestamp": "1626671191.163100",
      "is_reply": false
    },
    {
      "sender": "sudeep",
      "user_id": "UCWRN72EP",
      "message": "what type of slowness?",
      "time": "22:07",
      "timestamp": "1626671246.163200",
      "is_reply": true
    },
    {
      "sender": "Gunjan",
      "user_id": "U01V29NME2Y",
      "message": "creating flow or adding steps to it seems to take forever",
      "time": "22:07",
      "timestamp": "1626671269.163400",
      "is_reply": true
    },
    {
      "sender": "Gunjan",
      "user_id": "U01V29NME2Y",
      "message": "When this happens, it works for candidates after refreshing the page.",
      "time": "22:08",
      "timestamp": "1626671308.163600",
      "is_reply": true
    },
    {
      "sender": "Gunjan",
      "user_id": "U01V29NME2Y",
      "message": "Some candidates even faced slowness issues while creating a new folder",
      "time": "22:08",
      "timestamp": "1626671335.163800",
      "is_reply": true
    },
    {
      "sender": "Gunjan",
      "user_id": "U01V29NME2Y",
      "message": "it just keeps spinning, until they refresh and try to create again",
      "time": "22:09",
      "timestamp": "1626671353.164000",
      "is_reply": true
    },
    {
      "sender": "vineeth",
      "user_id": "U0175SZ13F0",
      "message": "ALso flow is not getting queued",
      "time": "22:17",
      "timestamp": "1626671841.164200",
      "is_reply": true
    },
    {
      "sender": "vineeth",
      "user_id": "U0175SZ13F0",
      "message": "Can some help here please?",
      "time": "22:20",
      "timestamp": "1626672012.164400",
      "is_reply": true
    },
    {
      "sender": "sudeep",
      "user_id": "UCWRN72EP",
      "message": "looking into it. Also in general we should be using training envs for training?",
      "time": "22:21",
      "timestamp": "1626672103.164600",
      "is_reply": true
    },
    {
      "sender": "Gunjan",
      "user_id": "U01V29NME2Y",
      "message": "@sudeep we are using the same space that was used last week for training",
      "time": "22:22",
      "timestamp": "1626672152.164800",
      "is_reply": true
    },
    {
      "sender": "Gunjan",
      "user_id": "U01V29NME2Y",
      "message": "By training env, do you mean their is seperate instance of IB that should be used for training?",
      "time": "22:23",
      "timestamp": "1626672214.165000",
      "is_reply": true
    },
    {
      "sender": "sudeep",
      "user_id": "UCWRN72EP",
      "message": "> seeing a lot of slowness on prod\nthis is ib.com (http://ib.com)? we have training envs now that are diff envs than ib.com (http://ib.com)",
      "time": "22:23",
      "timestamp": "1626672219.165200",
      "is_reply": true
    },
    {
      "sender": "Gunjan",
      "user_id": "U01V29NME2Y",
      "message": "yes, this is instabase.com (http://instabase.com)",
      "time": "22:23",
      "timestamp": "1626672232.165400",
      "is_reply": true
    },
    {
      "sender": "sudeep",
      "user_id": "UCWRN72EP",
      "message": "hey @Naveen - i am seeing a bunch of `DEADLINE_EXCEEDED` to license service in api-server-apps\nhttps://console.cloud.google.com/logs/query;query=resource.type%3D%22container%22%0Aresou[…]mp=2021-07-19T05:24:57.900529588Z?project=instabase-main (https://console.cloud.google.com/logs/query;query=resource.type%3D%22container%22%0Aresource.labels.cluster_name%3D%22instabase-main-prod-002%22%0Aresource.labels.namespace_id%3D%22instabase-prod%22%0Aresource.labels.project_id%3D%22instabase-main%22%0Aresource.labels.zone:%22us-central1-%22%0Aresource.labels.container_name%3D%2528%22api-server-apps%22%20OR%20%22jaeger-agent%22%2529%0Aresource.labels.pod_id:%22deployment-api-server-apps-%22%0A-textPayload:%22static%22;cursorTimestamp=2021-07-19T05:24:57.900529588Z?project=instabase-main)",
      "time": "22:26",
      "timestamp": "1626672381.165600",
      "is_reply": true
    },
    {
      "sender": "vineeth",
      "user_id": "U0175SZ13F0",
      "message": "They are seeing 503 service not available error",
      "time": "22:27",
      "timestamp": "1626672421.165900",
      "is_reply": true
    },
    {
      "sender": "sudeep",
      "user_id": "UCWRN72EP",
      "message": "yeah the internal errors can report back to them as 503 from the web services",
      "time": "22:28",
      "timestamp": "1626672498.166100",
      "is_reply": true
    },
    {
      "sender": "shaunak",
      "user_id": "UCY6SA014",
      "message": "there also seems to be a few restarts of api-server-apps",
      "time": "22:30",
      "timestamp": "1626672655.166300",
      "is_reply": true
    },
    {
      "sender": "sudeep",
      "user_id": "UCWRN72EP",
      "message": "Yep @shaunak - checking the restart timestamps",
      "time": "22:31",
      "timestamp": "1626672705.166500",
      "is_reply": true
    },
    {
      "sender": "sudeep",
      "user_id": "UCWRN72EP",
      "message": "@Gunjan @vineeth -  Do you know how many users are there in training env right now (wondering if this is a volume issue)?\n\nIn general the expectation is to use training envs that are sized for your requirement (let's chat later about this)\nhttps://instabase.slack.com/archives/C06FA5MBN/p1621363189006100?thread_ts=1621356226.001700&cid=C06FA5MBN\nhttps://instabase.slack.com/archives/C06FA6A23/p1624339240370800?thread_ts=1624338234.366800&cid=C06FA6A23",
      "time": "22:32",
      "timestamp": "1626672728.166700",
      "is_reply": true
    },
    {
      "sender": "shaunak",
      "user_id": "UCY6SA014",
      "message": "Looks like OOM killed @sudeep",
      "time": "22:32",
      "timestamp": "1626672767.167000",
      "is_reply": true
    },
    {
      "sender": "Gunjan",
      "user_id": "U01V29NME2Y",
      "message": "we have about 18 people including me and vineeth",
      "time": "22:33",
      "timestamp": "1626672782.167200",
      "is_reply": true
    },
    {
      "sender": "shaunak",
      "user_id": "UCY6SA014",
      "message": "@Gunjan and @vineeth are there any large flow binaries, models etc. that we are trying to upload through api-server-apps?",
      "time": "22:33",
      "timestamp": "1626672814.167500",
      "is_reply": true
    },
    {
      "sender": "shaunak",
      "user_id": "UCY6SA014",
      "message": "we might have to bump up the resources",
      "time": "22:33",
      "timestamp": "1626672821.167700",
      "is_reply": true
    },
    {
      "sender": "Gunjan",
      "user_id": "U01V29NME2Y",
      "message": "It was just a simple single flow, with 3 steps, extracting 1 field in refiner",
      "time": "22:34",
      "timestamp": "1626672853.167900",
      "is_reply": true
    },
    {
      "sender": "Gunjan",
      "user_id": "U01V29NME2Y",
      "message": "ran with 3 png files",
      "time": "22:34",
      "timestamp": "1626672862.168100",
      "is_reply": true
    },
    {
      "sender": "shaunak",
      "user_id": "UCY6SA014",
      "message": "got it",
      "time": "22:34",
      "timestamp": "1626672874.168300",
      "is_reply": true
    },
    {
      "sender": "shaunak",
      "user_id": "UCY6SA014",
      "message": "@Rakesh and @Naveen we need your help in figuring this out",
      "time": "22:36",
      "timestamp": "1626672996.168500",
      "is_reply": true
    },
    {
      "sender": "shaunak",
      "user_id": "UCY6SA014",
      "message": "can you please look at why api-server-apps are crashing?",
      "time": "22:36",
      "timestamp": "1626673004.168700",
      "is_reply": true
    },
    {
      "sender": "sudeep",
      "user_id": "UCWRN72EP",
      "message": "@shaunak - btw just confirmed restart time stamps the OOMKilled were on July 12th",
      "time": "22:37",
      "timestamp": "1626673026.168900",
      "is_reply": true
    },
    {
      "sender": "shaunak",
      "user_id": "UCY6SA014",
      "message": "oh okay",
      "time": "22:37",
      "timestamp": "1626673034.169100",
      "is_reply": true
    },
    {
      "sender": "shaunak",
      "user_id": "UCY6SA014",
      "message": "got it",
      "time": "22:37",
      "timestamp": "1626673036.169300",
      "is_reply": true
    },
    {
      "sender": "Rakesh",
      "user_id": "U01668DGQCE",
      "message": "I tried a simple flow - creating it, adding steps and it worked fine.",
      "time": "22:37",
      "timestamp": "1626673052.169500",
      "is_reply": true
    },
    {
      "sender": "sudeep",
      "user_id": "UCWRN72EP",
      "message": "i think the main concern i see here is the deadline exceeded errors to license service, seeing them across the pods",
      "time": "22:37",
      "timestamp": "1626673062.169700",
      "is_reply": true
    },
    {
      "sender": "shaunak",
      "user_id": "UCY6SA014",
      "message": "can we try it from JPMC context?",
      "time": "22:37",
      "timestamp": "1626673063.169900",
      "is_reply": true
    },
    {
      "sender": "shaunak",
      "user_id": "UCY6SA014",
      "message": "are we running into license issues?",
      "time": "22:38",
      "timestamp": "1626673081.170100",
      "is_reply": true
    },
    {
      "sender": "Rakesh",
      "user_id": "U01668DGQCE",
      "message": "@Gunjan - can you provide a link to flow?",
      "time": "22:38",
      "timestamp": "1626673092.170300",
      "is_reply": true
    },
    {
      "sender": "Gunjan",
      "user_id": "U01V29NME2Y",
      "message": "This is what Vineeth was demoing https://www.instabase.com/jpmc/JPMC_Training_07_12_2021/fs/Instabase%20Drive/workspac[…]ion-Flow-Output/pp-quest-net-solution/my_workflows/PP.ibflow (https://www.instabase.com/jpmc/JPMC_Training_07_12_2021/fs/Instabase%20Drive/workspaces/Vineeth/Session-Flow-Output/pp-quest-net-solution/my_workflows/PP.ibflow)",
      "time": "22:39",
      "timestamp": "1626673178.170500",
      "is_reply": true
    },
    {
      "sender": "shaunak",
      "user_id": "UCY6SA014",
      "message": "@Mohit in case he is online to help out as well",
      "time": "22:39",
      "timestamp": "1626673190.170700",
      "is_reply": true
    },
    {
      "sender": "Rakesh",
      "user_id": "U01668DGQCE",
      "message": "thanks @Gunjan - can you pls add @Rakesh, meanwhile I will run a similar flow using the questnet sample.",
      "time": "22:40",
      "timestamp": "1626673243.170900",
      "is_reply": true
    },
    {
      "sender": "Rakesh",
      "user_id": "U01668DGQCE",
      "message": "username -`Rakesh`",
      "time": "22:42",
      "timestamp": "1626673322.171100",
      "is_reply": true
    },
    {
      "sender": "Gunjan",
      "user_id": "U01V29NME2Y",
      "message": "Done",
      "time": "22:42",
      "timestamp": "1626673359.171300",
      "is_reply": true
    },
    {
      "sender": "shaunak",
      "user_id": "UCY6SA014",
      "message": "the `run_binary_async` api is taking 360+ seconds.",
      "time": "22:45",
      "timestamp": "1626673542.171500",
      "is_reply": true
    },
    {
      "sender": "Naveen",
      "user_id": "U0163TS8GR5",
      "message": "Looking into this: License service logs seem to return the request within 1ms…",
      "time": "22:47",
      "timestamp": "1626673669.171900",
      "is_reply": true
    },
    {
      "sender": "Rakesh",
      "user_id": "U01668DGQCE",
      "message": "I ran the binary 2-3 times and its working fine. Did licensing service/ pod restart?",
      "time": "22:48",
      "timestamp": "1626673700.172300",
      "is_reply": true
    },
    {
      "sender": "Naveen",
      "user_id": "U0163TS8GR5",
      "message": "As per grafana dashboard, there were no restarts recently… There seems to be one ~2 hours back",
      "time": "22:52",
      "timestamp": "1626673923.172500",
      "is_reply": true
    },
    {
      "sender": "Rakesh",
      "user_id": "U01668DGQCE",
      "message": "Looks like grpc errors against both file-service, license-service. Now again showing error against file-service.",
      "time": "22:54",
      "timestamp": "1626674072.172700",
      "is_reply": true
    },
    {
      "sender": "shaunak",
      "user_id": "UCY6SA014",
      "message": "hmm, @Naveen can you try to correlate the call at api-server-apps with the licensing service?",
      "time": "22:57",
      "timestamp": "1626674230.173100",
      "is_reply": true
    },
    {
      "sender": "shaunak",
      "user_id": "UCY6SA014",
      "message": "things seem to have gone back to normal for now",
      "time": "22:58",
      "timestamp": "1626674296.173300",
      "is_reply": true
    },
    {
      "sender": "sudeep",
      "user_id": "UCWRN72EP",
      "message": "yeah - i think most of this was happening until 28 mins ago (11 am IST)",
      "time": "22:58",
      "timestamp": "1626674339.173500",
      "is_reply": true
    },
    {
      "sender": "Gunjan",
      "user_id": "U01V29NME2Y",
      "message": "@sudeep Any idea why this was happening?",
      "time": "22:59",
      "timestamp": "1626674391.173700",
      "is_reply": true
    },
    {
      "sender": "sudeep",
      "user_id": "UCWRN72EP",
      "message": "No idea yet (except that the system had way too many requests). My suspicion is number of internal retries that were happening in api-server-apps (ex: to license service). we can confirm once @Naveen has also had a chance to correlate these with license server logs.",
      "time": "23:02",
      "timestamp": "1626674574.174000",
      "is_reply": true
    },
    {
      "sender": "Naveen",
      "user_id": "U0163TS8GR5",
      "message": "Sure @shaunak, will do!! +1 @sudeep, tried running a couple of flows, seems to be working…",
      "time": "23:03",
      "timestamp": "1626674593.174200",
      "is_reply": true
    },
    {
      "sender": "shaunak",
      "user_id": "UCY6SA014",
      "message": "thank you @Naveen!!",
      "time": "23:03",
      "timestamp": "1626674609.174500",
      "is_reply": true
    },
    {
      "sender": "Naveen",
      "user_id": "U0163TS8GR5",
      "message": "Just looked into logs: License service restarted at 9 AM IST ~2 hours ago, There was no request after that till 11 am IST (~30 minutes ago)",
      "time": "23:08",
      "timestamp": "1626674908.174800",
      "is_reply": true
    },
    {
      "sender": "sudeep",
      "user_id": "UCWRN72EP",
      "message": "Got it, given that we see api-server-apps making requests at that point with deadline_exceeded - i think the problem might be that this pod never got resolved on the client side for grpc requests (after the restart)",
      "time": "23:10",
      "timestamp": "1626675003.175200",
      "is_reply": true
    },
    {
      "sender": "shaunak",
      "user_id": "UCY6SA014",
      "message": "@Naveen can you try and reproduce this error on dogfood, or some other environment?  It would be good to see if this is something that is fundamentally broken in he grpc client code.",
      "time": "23:50",
      "timestamp": "1626677422.175600",
      "is_reply": true
    },
    {
      "sender": "shaunak",
      "user_id": "UCY6SA014",
      "message": "This would also explain some of the grpc inconsistency that we saw in the file-service outage as well",
      "time": "23:50",
      "timestamp": "1626677446.175800",
      "is_reply": true
    }
  ],
  "metadata": {
    "channel_id": "C06FA6A23",
    "channel_name": "discuss-engineering",
    "date_file": "2021-07-18.json",
    "message_count": 57,
    "start_time": "1626671191.163100",
    "end_time": "1626677446.175800",
    "is_thread": true
  }
}