{
  "id": "ch_C06FA6A23_2024-04-17_1713400220.137419_thread",
  "type": "channel",
  "channel_name": "discuss-engineering",
  "conversation_type": "thread",
  "participants": [
    "Xindi Xu",
    "Heymian",
    "Sunny Khatri",
    "Cheryl Zhou"
  ],
  "messages": [
    {
      "sender": "Xindi Xu",
      "user_id": "U03FT35MAHF",
      "message": "Hey team. I added a new grpc endpoint to account_service and I'm updating the typing stub so that mypy understands it. I edited `shared-utils/py-utils/typing-utils/src/py/stubs/instabase/protos/account_service/account_service_pb2_grpc.pyi` by adding:\n```    def GetOrgFeatureFlags(self, request):\n        # type: (account_service_pb2.GetOrgFeatureFlagsReq) -> (account_service_pb2.GetOrgFeatureFlagsResp)\n        pass ```\nIt doesn't seem to work. `make mypy-unit-tests` still failed with type errors. Am I missing any steps on updating the typing?",
      "time": "17:30",
      "timestamp": "1713400220.137419",
      "is_reply": false
    },
    {
      "sender": "Xindi Xu",
      "user_id": "U03FT35MAHF",
      "message": "My global python version is `3.7.13` . I've ran these and they all completed successfully\n```pip3 install -r  $IB_HOME/tools/devtools/code-dependencies/python/requirements_py37.txt\n\ncd tools/devtools && make update-python```",
      "time": "17:46",
      "timestamp": "1713401178.178989",
      "is_reply": true
    },
    {
      "sender": "Sunny Khatri",
      "user_id": "U06KR4QB6E5",
      "message": "Wait why are you editing pb2 files directly ? These should be generated from proto.",
      "time": "17:51",
      "timestamp": "1713401496.514809",
      "is_reply": true
    },
    {
      "sender": "Xindi Xu",
      "user_id": "U03FT35MAHF",
      "message": "Yea, I think this also should be autogenerated but I believe our tooling is broken :thinking_face: . Folks have been manually updating .pyi files https://instabase.slack.com/archives/C011FHLBN8N/p1705427454314469",
      "time": "17:54",
      "timestamp": "1713401656.641769",
      "is_reply": true
    },
    {
      "sender": "Sunny Khatri",
      "user_id": "U06KR4QB6E5",
      "message": "Ohh. It doesn’t seem like the right usage of protos. In many production scenarios, generated files are not even checked in repo, only reside at local during build, and compiled and generated during CI/CD.",
      "time": "18:01",
      "timestamp": "1713402095.794129",
      "is_reply": true
    },
    {
      "sender": "Xindi Xu",
      "user_id": "U03FT35MAHF",
      "message": "Yea. I was also wondering why we check in generated files for python and js, but not those for golang.",
      "time": "18:02",
      "timestamp": "1713402178.091669",
      "is_reply": true
    },
    {
      "sender": "Cheryl Zhou",
      "user_id": "U030KCEN6NA",
      "message": "There are two classes in that .pyi. You might need to add that stub twice",
      "time": "18:06",
      "timestamp": "1713402392.435879",
      "is_reply": true
    },
    {
      "sender": "Xindi Xu",
      "user_id": "U03FT35MAHF",
      "message": "Ahhh! yep. That fixes the issue. Thanks a lot Cheryl.",
      "time": "18:08",
      "timestamp": "1713402508.191629",
      "is_reply": true
    },
    {
      "sender": "Heymian",
      "user_id": "UADQ9V8PK",
      "message": "History lesson for why stubs got checked in started way back in the early days of Instabase when the engineers working heavily in python got annoyed by the noticeably slower builds caused by file re-generation, and the lack of indexing against generated files. There was also that one .pyi file Cheryl mentioned above that we just couldn’t get mypy working against, and that’s why we’ve been stuck with that manual edit when adding new endpoints. If anyone can figure out the mypy issue properly, we’d love to avoid it. :smile:",
      "time": "18:31",
      "timestamp": "1713403870.765999",
      "is_reply": true
    }
  ],
  "metadata": {
    "channel_id": "C06FA6A23",
    "channel_name": "discuss-engineering",
    "date_file": "2024-04-17.json",
    "message_count": 9,
    "start_time": "1713400220.137419",
    "end_time": "1713403870.765999",
    "is_thread": true
  }
}