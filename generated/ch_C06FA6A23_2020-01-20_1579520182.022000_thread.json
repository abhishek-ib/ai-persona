{
  "id": "ch_C06FA6A23_2020-01-20_1579520182.022000_thread",
  "type": "channel",
  "channel_name": "discuss-engineering",
  "conversation_type": "thread",
  "participants": [
    "shaunak",
    "Aaron Tami",
    "Heymian",
    "sudeep"
  ],
  "messages": [
    {
      "sender": "sudeep",
      "user_id": "UCWRN72EP",
      "message": "```[2020-01-20 11:31:03,813] {/instabase-server/py/instabase/utils/web/handler_util.py:36} ERROR - Received exception in WEBAPP: 'NoneType' object has no attribute 'id'\nTraceback (most recent call last):\n  File \"/instabase-server/py/instabase/utils/web/handler_util.py\", line 33, in inner_func\n    return f(*args, **kwargs)\n  File \"/instabase-server/py/instabase/handler/views/account.py\", line 391, in post\n    user_session = get_session_from_user(user)\n  File \"/instabase-server/py/instabase/shared/auth.py\", line 87, in get_session_from_user\n    id=user.id,\nAttributeError: 'NoneType' object has no attribute 'id'\n\n[2020-01-20 11:31:03,818] {/home/ibuser/.local/lib/python2.7/site-packages/flask/app.py:1753} ERROR - Exception on /account/ldap/login [POST]\nTraceback (most recent call last):\n  File \"/home/ibuser/.local/lib/python2.7/site-packages/flask/app.py\", line 2284, in wsgi_app\n    response = self.full_dispatch_request()\n  File \"/home/ibuser/.local/lib/python2.7/site-packages/flask/app.py\", line 1807, in full_dispatch_request\n    rv = self.handle_user_exception(e)\n  File \"/home/ibuser/.local/lib/python2.7/site-packages/flask/app.py\", line 1710, in handle_user_exception\n    reraise(exc_type, exc_value, tb)\n  File \"/home/ibuser/.local/lib/python2.7/site-packages/flask/app.py\", line 1805, in full_dispatch_request\n    rv = self.dispatch_request()\n  File \"/home/ibuser/.local/lib/python2.7/site-packages/flask/app.py\", line 1791, in dispatch_request\n    return self.view_functions[rule.endpoint](**req.view_args)\n  File \"/home/ibuser/.local/lib/python2.7/site-packages/flask/views.py\", line 88, in view\n    return self.dispatch_request(*args, **kwargs)\n  File \"/home/ibuser/.local/lib/python2.7/site-packages/flask/views.py\", line 158, in dispatch_request\n    return meth(*args, **kwargs)\n  File \"/instabase-server/py/instabase/utils/web/handler_util.py\", line 41, in inner_func\n    return bad_request(msg)\n  File \"/instabase-server/py/instabase/utils/web/handler_util.py\", line 25, in bad_request\n    return render_template('error.html', context=context)\n  File \"/instabase-server/py/instabase/utils/web/flask_util.py\", line 101, in render_template\n    context['launcher'] = _get_launcher_dict(context, app_config)\n  File \"/instabase-server/py/instabase/utils/web/flask_util.py\", line 49, in _get_launcher_dict\n    launcher['orgs'] = fetch_all_orgs()\n  File \"/instabase-server/py/instabase/utils/web/launcher_util.py\", line 213, in fetch_all_orgs\n    for org in resp.orgs:\nTypeError: 'NoneType' object is not iterable\nTraceback (most recent call last):\n  File \"/home/ibuser/.local/lib/python2.7/site-packages/gevent/pywsgi.py\", line 935, in handle_one_response\n    self.run_application()\n  File \"/home/ibuser/.local/lib/python2.7/site-packages/gevent/pywsgi.py\", line 908, in run_application\n    self.result = self.application(self.environ, self.start_response)\n  File \"/home/ibuser/.local/lib/python2.7/site-packages/flask/app.py\", line 2301, in __call__\n    return self.wsgi_app(environ, start_response)\n  File \"/home/ibuser/.local/lib/python2.7/site-packages/flask/app.py\", line 2287, in wsgi_app\n    response = self.handle_exception(e)\n  File \"/home/ibuser/.local/lib/python2.7/site-packages/flask/app.py\", line 1740, in handle_exception\n    return self.finalize_request(handler(e), from_error_handler=True)\n  File \"manage.py\", line 107, in handle_error\n    return render_template('error.html', context=context)\n  File \"/instabase-server/py/instabase/utils/web/flask_util.py\", line 101, in render_template\n    context['launcher'] = _get_launcher_dict(context, app_config)\n  File \"/instabase-server/py/instabase/utils/web/flask_util.py\", line 53, in _get_launcher_dict\n    launcher['bookmarks'] = get_bookmarks()\n  File \"/instabase-server/py/instabase/utils/web/launcher_util.py\", line 44, in get_bookmarks\n    lambda proto: proto.bookmarks_info)\n  File \"/instabase-server/py/instabase/utils/web/launcher_util.py\", line 37, in get_preference\n    account_client, enable_v2_tables)\n  File \"/instabase-server/py/instabase/platform_preferences_utils/database.py\", line 43, in get_preference\n    json_format.Parse(resp.preference, pref_pb)\n  File \"/home/ibuser/.local/lib/python2.7/site-packages/google/protobuf/json_format.py\", line 397, in Parse\n    if not isinstance(text, six.text_type): text = text.decode('utf-8')\nAttributeError: 'NoneType' object has no attribute 'decode'\nMon Jan 20 11:31:03 2020 {'REMOTE_PORT': '35204', 'HTTP_HOST': 'instabase.apps.fsk-hk-np1.ocp.standardchartered.com (http://instabase.apps.fsk-hk-np1.ocp.standardchartered.com)', 'REMOTE_ADDR': '192.168.2.31', (hidden keys: 39)} failed with AttributeError```",
      "time": "03:36",
      "timestamp": "1579520182.022000",
      "is_reply": false
    },
    {
      "sender": "sudeep",
      "user_id": "UCWRN72EP",
      "message": "Compared branches release-2019-10-21 (last shipped to SC) and release-2019-10-21.sc-msft (shipped this time to SC) => there are some extra commits in the latter that are not Msft OCR related. Going to recreate a new release branch without these commits.",
      "time": "04:39",
      "timestamp": "1579523987.022200",
      "is_reply": true
    },
    {
      "sender": "sudeep",
      "user_id": "UCWRN72EP",
      "message": "this is the new branch without the extra commits `release-2019-10-21.sc-msft-new` going to cut a new release from this and try to see how that goes",
      "time": "04:41",
      "timestamp": "1579524090.022400",
      "is_reply": true
    },
    {
      "sender": "sudeep",
      "user_id": "UCWRN72EP",
      "message": "@Aaron Tami @Ashish let me know if you see any issues",
      "time": "04:42",
      "timestamp": "1579524141.022600",
      "is_reply": true
    },
    {
      "sender": "Aaron Tami",
      "user_id": "UGG8PLD2P",
      "message": "that surprises me, as i forked this branch off `release-2019-10-21`.  How many extra commits are you seeing and what were they? Did we hit this error when they tried to deploy? I think we have deployed this release to other customers without issue.",
      "time": "10:53",
      "timestamp": "1579546404.022800",
      "is_reply": true
    },
    {
      "sender": "sudeep",
      "user_id": "UCWRN72EP",
      "message": "@Aaron Tami yeah. most of these additional commits relate to Thrift 0.13.0",
      "time": "11:09",
      "timestamp": "1579547393.023000",
      "is_reply": true
    },
    {
      "sender": "Aaron Tami",
      "user_id": "UGG8PLD2P",
      "message": "Oh i see, i think this was also deployed to RBS and OpenLane, will this be impacting them as well?",
      "time": "11:10",
      "timestamp": "1579547448.023200",
      "is_reply": true
    },
    {
      "sender": "sudeep",
      "user_id": "UCWRN72EP",
      "message": "i am not sure as i have not narrowed this to a specific commit, but both issue looks to be unrelated to thrift 0.13.0 and are likely from a smaller commit with rest of these ..",
      "time": "11:12",
      "timestamp": "1579547536.023400",
      "is_reply": true
    },
    {
      "sender": "sudeep",
      "user_id": "UCWRN72EP",
      "message": "was thinking same earlier today that we shipped same SHA to GS too and if they will be impacted",
      "time": "11:14",
      "timestamp": "1579547657.023600",
      "is_reply": true
    },
    {
      "sender": "Aaron Tami",
      "user_id": "UGG8PLD2P",
      "message": "not sure how those commits got in there... were they cherrypicks?",
      "time": "11:16",
      "timestamp": "1579547775.024300",
      "is_reply": true
    },
    {
      "sender": "Aaron Tami",
      "user_id": "UGG8PLD2P",
      "message": "i only recall cherrypicking microsoft ocr related commits",
      "time": "11:16",
      "timestamp": "1579547786.024500",
      "is_reply": true
    },
    {
      "sender": "shaunak",
      "user_id": "UCY6SA014",
      "message": "@sudeep all of these errors seem to be coming from the fact that we are not able to communicate with account-service.  It is possible that upgrade to thrift might have caused these problems.",
      "time": "11:41",
      "timestamp": "1579549265.024700",
      "is_reply": true
    },
    {
      "sender": "sudeep",
      "user_id": "UCWRN72EP",
      "message": "Just chatting with Heymian - and SC had issues with account service a couple days before too with queries to DB failing due to disk issues. I did not look at acocunt service logs on call with Gopu",
      "time": "11:53",
      "timestamp": "1579549982.024900",
      "is_reply": true
    },
    {
      "sender": "sudeep",
      "user_id": "UCWRN72EP",
      "message": "so if we could get the logs that will be great.",
      "time": "11:53",
      "timestamp": "1579550034.025100",
      "is_reply": true
    },
    {
      "sender": "sudeep",
      "user_id": "UCWRN72EP",
      "message": "also sent the logs with db issue over email to compare just in case",
      "time": "12:00",
      "timestamp": "1579550430.025300",
      "is_reply": true
    },
    {
      "sender": "Aaron Tami",
      "user_id": "UGG8PLD2P",
      "message": "I think with our other clients (RBS/OpenLane) we have only been deploying app-tasks and ocr-msft, so maybe thats why they didn't see any issues",
      "time": "12:23",
      "timestamp": "1579551797.025500",
      "is_reply": true
    },
    {
      "sender": "sudeep",
      "user_id": "UCWRN72EP",
      "message": "@Aaron Tami - yeah that could be the thing. Also the extra commits may not be a problem, its just an approach to get them unblocked and also narrow down the problem",
      "time": "12:41",
      "timestamp": "1579552863.025700",
      "is_reply": true
    },
    {
      "sender": "Heymian",
      "user_id": "UADQ9V8PK",
      "message": "in case anyone is following this thread, this particular problem with account service has been fixed. we just repushed it again and all was good.",
      "time": "21:47",
      "timestamp": "1579585648.028400",
      "is_reply": true
    },
    {
      "sender": "sudeep",
      "user_id": "UCWRN72EP",
      "message": "Update: @Heymian @achao  and i looked at this further for the connection issues we were seeing with the account service. There were no errors in the logs, and upon restarting the account service the webapp errors are not there. The login also works fine atm.\n\nWe are checking Microsoft OCR right now.",
      "time": "21:52",
      "timestamp": "1579585959.031800",
      "is_reply": true
    },
    {
      "sender": "shaunak",
      "user_id": "UCY6SA014",
      "message": ":thumbsup_all: we saw similar issues with file-tservice and webapp as well when Aaron was debugging the file issue.  Restart file-tservice / webapp fixed the issue there as well",
      "time": "22:01",
      "timestamp": "1579586474.032000",
      "is_reply": true
    }
  ],
  "metadata": {
    "channel_id": "C06FA6A23",
    "channel_name": "discuss-engineering",
    "date_file": "2020-01-20.json",
    "message_count": 20,
    "start_time": "1579520182.022000",
    "end_time": "1579586474.032000",
    "is_thread": true
  }
}