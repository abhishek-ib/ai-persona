{
  "id": "ch_C0516UPPMT3_2023-12-19_1702994419.914009_thread",
  "type": "channel",
  "channel_name": "aihub-feedback",
  "conversation_type": "thread",
  "participants": [
    "danny.lan",
    "CJ",
    "Arjun",
    "Lee",
    "Eric Han",
    "daniel",
    "Serena",
    "lydia"
  ],
  "messages": [
    {
      "sender": "Lee",
      "user_id": "U01J31371LZ",
      "message": "Hey i’ve noticed in the new release clicking on a class doesn’t auto select a document of that type anymore. You need to manually select if from the document list. Is this a bug or an intended change? Either way, can we change it back?",
      "time": "06:00",
      "timestamp": "1702994419.914009",
      "is_reply": false
    },
    {
      "sender": "Eric Han",
      "user_id": "UKPHNU5QE",
      "message": "@CJ or @Serena",
      "time": "08:26",
      "timestamp": "1703003216.279839",
      "is_reply": true
    },
    {
      "sender": "CJ",
      "user_id": "U05L4KP9V9P",
      "message": "intended?",
      "time": "08:27",
      "timestamp": "1703003242.089789",
      "is_reply": true
    },
    {
      "sender": "Arjun",
      "user_id": "U03T41QAMN1",
      "message": "I thought it’s only expected behavior if the class is being edited, otherwise the behavior should be the same?",
      "time": "08:38",
      "timestamp": "1703003897.175579",
      "is_reply": true
    },
    {
      "sender": "Arjun",
      "user_id": "U03T41QAMN1",
      "message": "although right now what I’m seeing is that switching the class just goes to “No documents selected”, which is definitely a worse UX",
      "time": "08:38",
      "timestamp": "1703003937.358269",
      "is_reply": true
    },
    {
      "sender": "Arjun",
      "user_id": "U03T41QAMN1",
      "message": "and probably a bug",
      "time": "08:39",
      "timestamp": "1703003940.222369",
      "is_reply": true
    },
    {
      "sender": "Lee",
      "user_id": "U01J31371LZ",
      "message": "There’s a mix of behaviour here. If you click on the doc it adjusts the config panel to that class. But if you choose a class in the config panel it doesn’t choose a doc of that class anymore.",
      "time": "08:39",
      "timestamp": "1703003966.233039",
      "is_reply": true
    },
    {
      "sender": "Arjun",
      "user_id": "U03T41QAMN1",
      "message": "yeah this behavior feels awkward if intended — requires an extra click now if I ever want to switch classes and edit the schema/extract values",
      "time": "08:41",
      "timestamp": "1703004064.153049",
      "is_reply": true
    },
    {
      "sender": "lydia",
      "user_id": "UJK4LKYSJ",
      "message": "@Lee did you have edited classes when seeing this behavior?",
      "time": "08:43",
      "timestamp": "1703004196.661789",
      "is_reply": true
    },
    {
      "sender": "Lee",
      "user_id": "U01J31371LZ",
      "message": "Do you mean ones I haven’t saved? If so, no.",
      "time": "08:43",
      "timestamp": "1703004216.399639",
      "is_reply": true
    },
    {
      "sender": "Arjun",
      "user_id": "U03T41QAMN1",
      "message": "the behavior I’m seeing is that the circular navigation is broken  even when there are no changes to the schema",
      "time": "08:43",
      "timestamp": "1703004232.553159",
      "is_reply": true
    },
    {
      "sender": "lydia",
      "user_id": "UJK4LKYSJ",
      "message": "Oh! That seems like a bug. This behavior should only happen if you have edited classes (since then all the docs are pending reclassification)",
      "time": "08:44",
      "timestamp": "1703004265.405579",
      "is_reply": true
    },
    {
      "sender": "lydia",
      "user_id": "UJK4LKYSJ",
      "message": "@CJ can you see what the issue is? I’m also wondering how we missed this in UAT - let’s add a unit test / cypress test for this",
      "time": "08:47",
      "timestamp": "1703004456.154109",
      "is_reply": true
    },
    {
      "sender": "Serena",
      "user_id": "U01CZ3LBFU4",
      "message": "i’m not able to reproduce on aihub-sandbox.internal - how should i reproduce? @Arjun",
      "time": "09:33",
      "timestamp": "1703007182.206339",
      "is_reply": true
    },
    {
      "sender": "Arjun",
      "user_id": "U03T41QAMN1",
      "message": "I reproduced this on preprod",
      "time": "09:33",
      "timestamp": "1703007194.315209",
      "is_reply": true
    },
    {
      "sender": "Arjun",
      "user_id": "U03T41QAMN1",
      "message": "just opened any project with > 1 class and selected a non-active class",
      "time": "09:33",
      "timestamp": "1703007220.925639",
      "is_reply": true
    },
    {
      "sender": "CJ",
      "user_id": "U05L4KP9V9P",
      "message": "yeah also :cannotreproduce: on aihub-sandbox",
      "time": "09:33",
      "timestamp": "1703007222.409099",
      "is_reply": true
    },
    {
      "sender": "Arjun",
      "user_id": "U03T41QAMN1",
      "message": "same actually, just tried",
      "time": "09:34",
      "timestamp": "1703007252.137729",
      "is_reply": true
    },
    {
      "sender": "CJ",
      "user_id": "U05L4KP9V9P",
      "message": "ok, but :reproduced: in preprod... god what changed in between",
      "time": "09:38",
      "timestamp": "1703007527.694259",
      "is_reply": true
    },
    {
      "sender": "Serena",
      "user_id": "U01CZ3LBFU4",
      "message": "i also can’t reproduce in preprod :confused_dog:",
      "time": "09:42",
      "timestamp": "1703007743.971539",
      "is_reply": true
    },
    {
      "sender": "Arjun",
      "user_id": "U03T41QAMN1",
      "message": "",
      "time": "09:43",
      "timestamp": "1703007781.209539",
      "is_reply": true
    },
    {
      "sender": "Serena",
      "user_id": "U01CZ3LBFU4",
      "message": "i’m so confused, if i click the tiny expand/collapse icon like in Arjun’s recording, I still see the correct behavior :lolcry:",
      "time": "09:44",
      "timestamp": "1703007854.116099",
      "is_reply": true
    },
    {
      "sender": "Arjun",
      "user_id": "U03T41QAMN1",
      "message": "I also tried with not using the icon and still see the incorrect behavior lol",
      "time": "09:44",
      "timestamp": "1703007891.992099",
      "is_reply": true
    },
    {
      "sender": "Serena",
      "user_id": "U01CZ3LBFU4",
      "message": "i created a new project in preprod, and i’m able to reproduce the issue in my new project",
      "time": "09:46",
      "timestamp": "1703008015.263489",
      "is_reply": true
    },
    {
      "sender": "CJ",
      "user_id": "U05L4KP9V9P",
      "message": "still :cannotreproduce: in aihub-sandbox even with a new project",
      "time": "09:48",
      "timestamp": "1703008109.938749",
      "is_reply": true
    },
    {
      "sender": "Serena",
      "user_id": "U01CZ3LBFU4",
      "message": "we’re mixing up `doc_id` and `input_file_id`\n• in `selectClassId`, we call `isClassifying(doc.input_file_id)`\n• `isClassifying` calls `docIds.findIndex` and assumes that its argument is a `doc_id`\n• in my preprod project where i can reproduce this, the `docId` passed to `docIds.findIndex` (1417) doesn’t exist in `docIds` ([1410, 1411, 1413, 1414])\nshould we be using `input_file_ids.findIndex` in `isClassifying`? @Arjun",
      "time": "09:59",
      "timestamp": "1703008789.301499",
      "is_reply": true
    },
    {
      "sender": "Arjun",
      "user_id": "U03T41QAMN1",
      "message": "ah interesting, this must be one spot that I forgot to change when updating `useClassify` to index on `docId` again instead of `inputFileId`",
      "time": "10:02",
      "timestamp": "1703008950.480279",
      "is_reply": true
    },
    {
      "sender": "Serena",
      "user_id": "U01CZ3LBFU4",
      "message": "this explains the frontend bug, but there are still some unexplained things\n• idk why `doc_id` and `input_file_id` are different in my preprod project since i don’t have split classification enabled\n    ◦ i see `\"extraction_mode\": null` in the API response for the project details\n• idk why this works on aihub-sandbox - maybe if we enable split classification in aihub-sandbox, we’ll reproduce the same frontend bug?",
      "time": "10:02",
      "timestamp": "1703008971.813649",
      "is_reply": true
    },
    {
      "sender": "Arjun",
      "user_id": "U03T41QAMN1",
      "message": "nice catch! we should use docId here. afaik there isn’t necessarily a guaranteed correlation between `docId` and `inputFileId` regardless of extraction mode",
      "time": "10:03",
      "timestamp": "1703009016.646509",
      "is_reply": true
    },
    {
      "sender": "Arjun",
      "user_id": "U03T41QAMN1",
      "message": "which makes it interesting that this works in some projects and not others but :shrug::skin-tone-4:",
      "time": "10:04",
      "timestamp": "1703009045.515159",
      "is_reply": true
    },
    {
      "sender": "CJ",
      "user_id": "U05L4KP9V9P",
      "message": "it would make sense for this to be hard to repro if it's dependent on isClassifying?",
      "time": "10:05",
      "timestamp": "1703009112.771829",
      "is_reply": true
    },
    {
      "sender": "Serena",
      "user_id": "U01CZ3LBFU4",
      "message": "btw i found this out by setting breakpoints in the `selectClassId` logic and the `isClassifying` logic",
      "time": "10:06",
      "timestamp": "1703009162.499629",
      "is_reply": true
    },
    {
      "sender": "lydia",
      "user_id": "UJK4LKYSJ",
      "message": "@Serena do you know when this bug happens? Is it only for split-classification projects?",
      "time": "11:56",
      "timestamp": "1703015774.318559",
      "is_reply": true
    },
    {
      "sender": "Arjun",
      "user_id": "U03T41QAMN1",
      "message": "I’m able to reproduce this on a non-split classification project in preprod — I’m struggling to understand what projects are affected",
      "time": "11:57",
      "timestamp": "1703015838.221429",
      "is_reply": true
    },
    {
      "sender": "Serena",
      "user_id": "U01CZ3LBFU4",
      "message": "this bug occurs when `doc_id` and `input_file_id` are different - apparently, turning off split classification doesn’t ensure that they’re the same (https://instabase.slack.com/archives/C0516UPPMT3/p1703009016646509?thread_ts=1702994419.914009&cid=C0516UPPMT3)\n\n@Elan Sharony do you know in what cases `doc_id` and `input_file_id` are different?",
      "time": "11:58",
      "timestamp": "1703015927.899299",
      "is_reply": true
    },
    {
      "sender": "Arjun",
      "user_id": "U03T41QAMN1",
      "message": "cc @daniel",
      "time": "11:59",
      "timestamp": "1703015944.734979",
      "is_reply": true
    },
    {
      "sender": "Arjun",
      "user_id": "U03T41QAMN1",
      "message": "@Serena see this example on my localhost where:\n1. doc id and input file Id are different for every file\n2. I’m *not* able to reproduce the bug",
      "time": "12:02",
      "timestamp": "1703016172.127619",
      "is_reply": true
    },
    {
      "sender": "Arjun",
      "user_id": "U03T41QAMN1",
      "message": "okay so it looks like your explanation is partially correct — the discrepancy between `input_file_id` and `doc_id` causes `useSelectClassId` to not find a doc and trigger the redux update, but then it looks like the `useEffect` on line 136 in `ActiveProject` kicks in to set the document there",
      "time": "12:05",
      "timestamp": "1703016348.976159",
      "is_reply": true
    },
    {
      "sender": "CJ",
      "user_id": "U05L4KP9V9P",
      "message": "oh god, that useEffect should only be on initial load...",
      "time": "12:06",
      "timestamp": "1703016376.818579",
      "is_reply": true
    },
    {
      "sender": "Arjun",
      "user_id": "U03T41QAMN1",
      "message": "and it looks like @danny.lan updated the useEffect 2 week ago which explains why we see this in preprod and not sandbox/local",
      "time": "12:06",
      "timestamp": "1703016380.522259",
      "is_reply": true
    },
    {
      "sender": "Arjun",
      "user_id": "U03T41QAMN1",
      "message": "that useEffect gets triggered because it has `selectedClassId` as a dependency",
      "time": "12:06",
      "timestamp": "1703016407.502359",
      "is_reply": true
    },
    {
      "sender": "Serena",
      "user_id": "U01CZ3LBFU4",
      "message": "@danny.lan what do you think about backporting your fix (https://github.com/instabase/instabase/pull/50788)? it seems pretty small",
      "time": "12:09",
      "timestamp": "1703016566.369819",
      "is_reply": true
    },
    {
      "sender": "Arjun",
      "user_id": "U03T41QAMN1",
      "message": "i think we should still fix  `useSelectClassId` , the question is which fix gets backported",
      "time": "12:10",
      "timestamp": "1703016631.854539",
      "is_reply": true
    },
    {
      "sender": "daniel",
      "user_id": "U039ZHK0MQF",
      "message": "No there isn’t a guaranteed correlation between `docId` and `inputFileId` . These ids are auto incrementing primary key. It’s just that right now the only scenerio we insert db entry in `input files` table is during digitization, which is immediately followed by inserting entry into `docs` table. Maybe that explains why `docId` and `inputFileId`  remains the same in some old env? But once split classification is executed in an env, that equivalence should break and inputFileId won’t catch up any more",
      "time": "12:14",
      "timestamp": "1703016866.550119",
      "is_reply": true
    },
    {
      "sender": "danny.lan",
      "user_id": "U03R26W3CDU",
      "message": "I can backport my PR, that’d probably be the quickest solution",
      "time": "12:16",
      "timestamp": "1703016964.937289",
      "is_reply": true
    },
    {
      "sender": "Arjun",
      "user_id": "U03T41QAMN1",
      "message": "https://github.com/instabase/instabase/pull/51342",
      "time": "12:46",
      "timestamp": "1703018786.780719",
      "is_reply": true
    },
    {
      "sender": "lydia",
      "user_id": "UJK4LKYSJ",
      "message": "@Arjun do we need your PR cherry-picked to 23.49?",
      "time": "13:17",
      "timestamp": "1703020625.989129",
      "is_reply": true
    },
    {
      "sender": "Arjun",
      "user_id": "U03T41QAMN1",
      "message": "it seems like Danny has already backported his PR, so that should cover the fix. Only one of the two needs to be backported",
      "time": "13:31",
      "timestamp": "1703021503.091489",
      "is_reply": true
    }
  ],
  "metadata": {
    "channel_id": "C0516UPPMT3",
    "channel_name": "aihub-feedback",
    "date_file": "2023-12-19.json",
    "message_count": 48,
    "start_time": "1702994419.914009",
    "end_time": "1703021503.091489",
    "is_thread": true
  }
}