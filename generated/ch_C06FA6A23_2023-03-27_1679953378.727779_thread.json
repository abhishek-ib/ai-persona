{
  "id": "ch_C06FA6A23_2023-03-27_1679953378.727779_thread",
  "type": "channel",
  "channel_name": "discuss-engineering",
  "conversation_type": "thread",
  "participants": [
    "Kerry",
    "Anil",
    "Atul Grover",
    "Aaron Tami",
    "Dominic Fannjiang",
    "Serena"
  ],
  "messages": [
    {
      "sender": "Aaron Tami",
      "user_id": "UGG8PLD2P",
      "message": "Hi,\n\nWe just completed an upgrade for CapitalOne from 22.01 to 23.01.  They have been doing testing on the new environment today with their previous solutions and are running into this error on one of their flows. Can someone help me take a look at this?",
      "time": "14:42",
      "timestamp": "1679953378.727779",
      "is_reply": false
    },
    {
      "sender": "Aaron Tami",
      "user_id": "UGG8PLD2P",
      "message": "cc @Bhuvnesh Gupta @Atul Grover",
      "time": "14:43",
      "timestamp": "1679953389.144289",
      "is_reply": true
    },
    {
      "sender": "Serena",
      "user_id": "U01CZ3LBFU4",
      "message": "can you share the logs for this flow run?",
      "time": "15:01",
      "timestamp": "1679954486.295759",
      "is_reply": true
    },
    {
      "sender": "Aaron Tami",
      "user_id": "UGG8PLD2P",
      "message": "I can't take them off this C1 computer, I can get on a zoom and show you tho",
      "time": "15:03",
      "timestamp": "1679954607.300549",
      "is_reply": true
    },
    {
      "sender": "Aaron Tami",
      "user_id": "UGG8PLD2P",
      "message": "or I can paste just the error statement I just found",
      "time": "15:05",
      "timestamp": "1679954718.742249",
      "is_reply": true
    },
    {
      "sender": "Aaron Tami",
      "user_id": "UGG8PLD2P",
      "message": "one second",
      "time": "15:05",
      "timestamp": "1679954721.560589",
      "is_reply": true
    },
    {
      "sender": "Aaron Tami",
      "user_id": "UGG8PLD2P",
      "message": "```03-27 21:14:01\ntask=Stage3\nstep=s4\nInstabase Call Stack: Traceback (most recent call last)\nFile \"/home/ibuser/.local/lib/python3.7/site-packages/billiard/pool.py\", line 362, in workloop\n\tresult = (True, prepare_result(fun(*args, **kwargs)))\nFile \"/home/ibuser/.local/lib/python3.7/site-packages/celery/app/trace.py\", line 650, in fast_trace_task\n\tuuid, args, kwargs, request,\nFile \"/home/ibuser/.local/lib/python3.7/site-packages/celery/app/trace.py\", line 451, in trace_task\n\tR = retval = fun(*args, **kwargs)\nFile \"/instabase/workers/celery-app-tasks/py/instabase/jobs/flow_task.py\", line 225, in __call__\n\treturn super().__call__(*args, **kwargs)\nFile \"/home/ibuser/.local/lib/python3.7/site-packages/celery/app/trace.py\", line 734, in __protected_call__\n\treturn self.run(*args, **kwargs)\nFile \"/home/ibuser/.local/lib/python3.7/site-packages/celery/app/autoretry.py\", line 34, in run\n\treturn task._orig_run(*args, **kwargs)\nFile \"/instabase/workers/celery-app-tasks/py/instabase/flow/v3/tasks.py\", line 111, in flow_stage_executor\n\tresult, err = runtime.run(stage_input.skip_stage)\nFile \"/instabase/workers/celery-app-tasks/py/instabase/executor_lib/executor/stage_executor.py\", line 654, in run\n\tstep_kwargs)\nFile \"/instabase/workers/celery-app-tasks/py/instabase/tracing/utils.py\", line 306, in wrapped\n\tr = func(*args, **kwargs)\nFile \"/instabase/workers/celery-app-tasks/py/instabase/flow/v3/step_util.py\", line 292, in run_flow_step\n\tlog_err=True)\n\ntrace\n03-27 21:14:01\ntask=Stage3\nstep=s4\nInstabase Error: Exception occured while running step s4 apply_refiner: 'NoneType' object is not iterable```",
      "time": "15:05",
      "timestamp": "1679954739.916769",
      "is_reply": true
    },
    {
      "sender": "Serena",
      "user_id": "U01CZ3LBFU4",
      "message": "i assume you also can’t share the refiner?\n\ncc @Dominic Fannjiang",
      "time": "15:10",
      "timestamp": "1679955034.997359",
      "is_reply": true
    },
    {
      "sender": "Dominic Fannjiang",
      "user_id": "U02TWH1FSG0",
      "message": "Is it possible to get more of a stacktrace for the error?",
      "time": "15:12",
      "timestamp": "1679955135.928209",
      "is_reply": true
    },
    {
      "sender": "Atul Grover",
      "user_id": "U03E1LBAE12",
      "message": "this is what their flow looks like, Is it even a valid flow?",
      "time": "15:19",
      "timestamp": "1679955545.591119",
      "is_reply": true
    },
    {
      "sender": "Aaron Tami",
      "user_id": "UGG8PLD2P",
      "message": "it was working on 22.01, was there some change in flow that makes this no longer valid?",
      "time": "15:22",
      "timestamp": "1679955738.514839",
      "is_reply": true
    },
    {
      "sender": "Aaron Tami",
      "user_id": "UGG8PLD2P",
      "message": "@Serena @Dominic Fannjiang I can't share any more info on here, but can jump on a zoom and go through any other info about the flow if it would be helpful",
      "time": "16:37",
      "timestamp": "1679960270.682299",
      "is_reply": true
    },
    {
      "sender": "Serena",
      "user_id": "U01CZ3LBFU4",
      "message": "i’m not familiar with this part of the codebase, but i can try to help if you need someone to look at this urgently",
      "time": "16:40",
      "timestamp": "1679960429.434299",
      "is_reply": true
    },
    {
      "sender": "Dominic Fannjiang",
      "user_id": "U02TWH1FSG0",
      "message": "@Aaron Tami I can hop on a zoom call in a few minutes. Ill DM you",
      "time": "16:41",
      "timestamp": "1679960472.109729",
      "is_reply": true
    },
    {
      "sender": "Aaron Tami",
      "user_id": "UGG8PLD2P",
      "message": "https://instabase.zoom.us/j/6318177189 if anyone else wants to join",
      "time": "16:57",
      "timestamp": "1679961459.112629",
      "is_reply": true
    },
    {
      "sender": "Dominic Fannjiang",
      "user_id": "U02TWH1FSG0",
      "message": "@Aaron Tami @Kerry I was able to make a flow with the same structure  here (https://release-23-01-0.aws.sandbox.instabase.com/apps/flow/edit/admin/domfj/fs/Instabase%20Drive/.instabase_projects/general/latest/flows/test_flow1/flow.ibflow) in the 23.01 sandbox and it worked fine. @Aaron Tami could you send the json files of the 2 refiner programs? I just want to see what kinds of refiner functions they are calling",
      "time": "17:25",
      "timestamp": "1679963124.227099",
      "is_reply": true
    },
    {
      "sender": "Aaron Tami",
      "user_id": "UGG8PLD2P",
      "message": "I don't think I can send them without permission from the client but we can get back on the zoom and take a look",
      "time": "17:27",
      "timestamp": "1679963261.615029",
      "is_reply": true
    },
    {
      "sender": "Kerry",
      "user_id": "UCX3VGDJR",
      "message": "cc @Anil here too -- if you can hop on the call to see if it's related to flow execution",
      "time": "17:28",
      "timestamp": "1679963285.986679",
      "is_reply": true
    },
    {
      "sender": "Kerry",
      "user_id": "UCX3VGDJR",
      "message": "what's weird is that there's a actual valid output in the s4 folder, but the stage failed in the ibflowresult file",
      "time": "17:28",
      "timestamp": "1679963311.436809",
      "is_reply": true
    },
    {
      "sender": "Aaron Tami",
      "user_id": "UGG8PLD2P",
      "message": "also want to add we are running 23.01.6, which was the first GA version of 23.01",
      "time": "17:42",
      "timestamp": "1679964157.363569",
      "is_reply": true
    },
    {
      "sender": "Kerry",
      "user_id": "UCX3VGDJR",
      "message": "um can we use the latest 23.01 (not for solving this bug, but just knowing how many patches that are there already)",
      "time": "17:43",
      "timestamp": "1679964202.195209",
      "is_reply": true
    },
    {
      "sender": "Aaron Tami",
      "user_id": "UGG8PLD2P",
      "message": "ya we can update to the latest, ideally we can do it once we figure this one out so we can only do it once.  when we started this upgrade process it was 23.01.6 and it takes a while to get new containers in C1, they have a really weird release process",
      "time": "17:47",
      "timestamp": "1679964467.300899",
      "is_reply": true
    },
    {
      "sender": "Aaron Tami",
      "user_id": "UGG8PLD2P",
      "message": "We were able to run the refiner program as a standalone without any errors.  @Dominic Fannjiang looked further into the stack trace and it appears to be failing while trying to write logs",
      "time": "17:52",
      "timestamp": "1679964749.992369",
      "is_reply": true
    },
    {
      "sender": "Dominic Fannjiang",
      "user_id": "U02TWH1FSG0",
      "message": "I will make a PR to fix and @Aaron Tami will deploy the fix to capital one by just redeploying `celery-app-tasks` as soon as we get the fix backported to 23.01. In the mean time I will also try to recreate the error in the 23.01 sandbox.",
      "time": "18:02",
      "timestamp": "1679965341.772359",
      "is_reply": true
    },
    {
      "sender": "Dominic Fannjiang",
      "user_id": "U02TWH1FSG0",
      "message": "I'm not sure how the situation occurred such that its failing while trying to write logs, but at least I can make a fix so that it doesn't error",
      "time": "18:06",
      "timestamp": "1679965575.764089",
      "is_reply": true
    },
    {
      "sender": "Kerry",
      "user_id": "UCX3VGDJR",
      "message": "This is so weird — maybe it’s a specific type of log? I’m also worried about just deployment app tasks, given that the rest of the services are so backwards",
      "time": "18:08",
      "timestamp": "1679965695.835229",
      "is_reply": true
    },
    {
      "sender": "Dominic Fannjiang",
      "user_id": "U02TWH1FSG0",
      "message": "PR here https://github.com/instabase/instabase/pull/38035",
      "time": "18:16",
      "timestamp": "1679966199.794809",
      "is_reply": true
    },
    {
      "sender": "Anil",
      "user_id": "U01BH8XBR55",
      "message": "Think we should verify this fixes the issue before shipping images.",
      "time": "18:18",
      "timestamp": "1679966314.261429",
      "is_reply": true
    },
    {
      "sender": "Dominic Fannjiang",
      "user_id": "U02TWH1FSG0",
      "message": "Yea that is one issue - we can't reproduce the issue ourselves yet. I'm working on that right now",
      "time": "18:19",
      "timestamp": "1679966385.505389",
      "is_reply": true
    },
    {
      "sender": "Aaron Tami",
      "user_id": "UGG8PLD2P",
      "message": "@Kerry what do you mean, worried about just deploying app-tasks without deploying everything else? We can also upgrade them to the latest version of everything",
      "time": "18:43",
      "timestamp": "1679967809.893489",
      "is_reply": true
    },
    {
      "sender": "Kerry",
      "user_id": "UCX3VGDJR",
      "message": "Let’s upgrade them to the latest version of everything. I’m worried about various service mismatch bugs that we have observed time and time again",
      "time": "19:05",
      "timestamp": "1679969101.481589",
      "is_reply": true
    }
  ],
  "metadata": {
    "channel_id": "C06FA6A23",
    "channel_name": "discuss-engineering",
    "date_file": "2023-03-27.json",
    "message_count": 31,
    "start_time": "1679953378.727779",
    "end_time": "1679969101.481589",
    "is_thread": true
  }
}