{
  "id": "ch_C06FA6A23_2021-08-18_1629304363.221200_thread",
  "type": "channel",
  "channel_name": "discuss-engineering",
  "conversation_type": "thread",
  "participants": [
    "Kerry",
    "Anil",
    "sudeep",
    "kunal",
    "Shubham Oli",
    "shaunak",
    "Travis",
    "lydia"
  ],
  "messages": [
    {
      "sender": "Kerry",
      "user_id": "UCX3VGDJR",
      "message": "prod is down? somehow not able to run any flows",
      "time": "09:32",
      "timestamp": "1629304363.221200",
      "is_reply": false
    },
    {
      "sender": "Kerry",
      "user_id": "UCX3VGDJR",
      "message": "getting intermittent 502s",
      "time": "09:33",
      "timestamp": "1629304408.221300",
      "is_reply": true
    },
    {
      "sender": "Kerry",
      "user_id": "UCX3VGDJR",
      "message": "",
      "time": "09:33",
      "timestamp": "1629304418.221500",
      "is_reply": true
    },
    {
      "sender": "shaunak",
      "user_id": "UCY6SA014",
      "message": "getting lots of crashes in api-server-apps: https://console.cloud.google.com/kubernetes/deployment/us-central1-c/instabase-main-prod-[…]rview?organizationId=396394272939&project=instabase-main (https://console.cloud.google.com/kubernetes/deployment/us-central1-c/instabase-main-prod-002/instabase-prod/deployment-api-server-apps/overview?organizationId=396394272939&project=instabase-main)",
      "time": "09:34",
      "timestamp": "1629304440.221900",
      "is_reply": true
    },
    {
      "sender": "shaunak",
      "user_id": "UCY6SA014",
      "message": "looking",
      "time": "09:34",
      "timestamp": "1629304447.222200",
      "is_reply": true
    },
    {
      "sender": "Kerry",
      "user_id": "UCX3VGDJR",
      "message": "seems to be back to normal now",
      "time": "09:35",
      "timestamp": "1629304555.222500",
      "is_reply": true
    },
    {
      "sender": "shaunak",
      "user_id": "UCY6SA014",
      "message": "yeah, but it is still crashing :disappointed:",
      "time": "09:46",
      "timestamp": "1629305215.222700",
      "is_reply": true
    },
    {
      "sender": "shaunak",
      "user_id": "UCY6SA014",
      "message": "@Anil can I get your help?  Most of the operations here are flow releated",
      "time": "09:47",
      "timestamp": "1629305233.222900",
      "is_reply": true
    },
    {
      "sender": "Kerry",
      "user_id": "UCX3VGDJR",
      "message": "yeah it’s very slow",
      "time": "09:49",
      "timestamp": "1629305356.223100",
      "is_reply": true
    },
    {
      "sender": "shaunak",
      "user_id": "UCY6SA014",
      "message": "@kunal let’s look at what might be happening here",
      "time": "09:53",
      "timestamp": "1629305625.223300",
      "is_reply": true
    },
    {
      "sender": "shaunak",
      "user_id": "UCY6SA014",
      "message": "Repushing the api-server-apps with DEBUG log enabled.",
      "time": "09:55",
      "timestamp": "1629305741.223500",
      "is_reply": true
    },
    {
      "sender": "kunal",
      "user_id": "U019YB70B8U",
      "message": "taking a look!",
      "time": "09:59",
      "timestamp": "1629305994.223700",
      "is_reply": true
    },
    {
      "sender": "shaunak",
      "user_id": "UCY6SA014",
      "message": "hold off for a few minutes :slightly_smiling_face:",
      "time": "10:01",
      "timestamp": "1629306114.223900",
      "is_reply": true
    },
    {
      "sender": "Shubham Oli",
      "user_id": "U01CKNF7BSL",
      "message": "readiness and liveness probes are failing frequently for api-server-apps container.",
      "time": "10:05",
      "timestamp": "1629306303.224100",
      "is_reply": true
    },
    {
      "sender": "Anil",
      "user_id": "U01BH8XBR55",
      "message": "sorry was in an interview, I can take a look in a while",
      "time": "10:07",
      "timestamp": "1629306477.224400",
      "is_reply": true
    },
    {
      "sender": "Anil",
      "user_id": "U01BH8XBR55",
      "message": "helping debug another bug :stuck_out_tongue:",
      "time": "10:08",
      "timestamp": "1629306485.224600",
      "is_reply": true
    },
    {
      "sender": "sudeep",
      "user_id": "UCWRN72EP",
      "message": "alerts that api-server apps was crashlooping btw\nhttps://instabase.slack.com/archives/C01FG18R59B/p1629305103008700",
      "time": "10:11",
      "timestamp": "1629306689.224800",
      "is_reply": true
    },
    {
      "sender": "shaunak",
      "user_id": "UCY6SA014",
      "message": "@Anil looks like the job-status APIs have become expensive: I think we started using this new format: `/api/v1/jobs/status?job_id=06c450be-27ea-4574-bffb-e3a9c55c4e21&type=flow` with `type=flow`  added to the API endpoint.",
      "time": "10:13",
      "timestamp": "1629306790.225100",
      "is_reply": true
    },
    {
      "sender": "shaunak",
      "user_id": "UCY6SA014",
      "message": "which release did this come in?",
      "time": "10:13",
      "timestamp": "1629306798.225300",
      "is_reply": true
    },
    {
      "sender": "Anil",
      "user_id": "U01BH8XBR55",
      "message": "https://github.com/instabase/instabase/pull/19753  - this landed in June. It was added back to previous releases like April too.\n\nJob Status endpoint is quite light. Not sure why that would become expensive.\n\nLooking at it now",
      "time": "10:19",
      "timestamp": "1629307192.225500",
      "is_reply": true
    },
    {
      "sender": "Shubham Oli",
      "user_id": "U01CKNF7BSL",
      "message": "From 45min ago - There is also a significant decrease in the file-service mem. consumption from 13+GB total to <4GB total.",
      "time": "10:20",
      "timestamp": "1629307203.225700",
      "is_reply": true
    },
    {
      "sender": "shaunak",
      "user_id": "UCY6SA014",
      "message": "Yes, this PR is on the job-service side.  There should be a corresponding PR on the frontend side that actually enables this change",
      "time": "10:40",
      "timestamp": "1629308441.226300",
      "is_reply": true
    },
    {
      "sender": "Kerry",
      "user_id": "UCX3VGDJR",
      "message": "@Eric Han @Travis mind find the corresponding PR for the frontend change that uses this API? @shaunak, what do you mean by “expensive” - seeing a lot of calls? or calls are slow?",
      "time": "10:49",
      "timestamp": "1629308996.226500",
      "is_reply": true
    },
    {
      "sender": "shaunak",
      "user_id": "UCY6SA014",
      "message": "they are utilizing much more CPU than before",
      "time": "10:51",
      "timestamp": "1629309071.226700",
      "is_reply": true
    },
    {
      "sender": "Kerry",
      "user_id": "UCX3VGDJR",
      "message": "got it; much more CPU from api-server-apps?",
      "time": "10:51",
      "timestamp": "1629309108.226900",
      "is_reply": true
    },
    {
      "sender": "shaunak",
      "user_id": "UCY6SA014",
      "message": "yeah — sorry for my terse replies.  on a debugging call with JPMC",
      "time": "10:56",
      "timestamp": "1629309382.227100",
      "is_reply": true
    },
    {
      "sender": "Anil",
      "user_id": "U01BH8XBR55",
      "message": "I am looking at this classifier job cdd62abc-11de-4d9a-9f2f-a610102b9777\nLooks like all status calls for this - there are many - take ~ 40s!\nhttps://console.cloud.google.com/kubernetes/pod/us-central1-c/instabase-main-prod-002/instabase-prod/deployment-api-server-apps-744cb86fdc-t885k/logs?project=instabase-main\n\n06c450be-27ea-4574-bffb-e3a9c55c4e21 - this is a flow. It once took 11s but most times it was finishing in < 0.3s - so likely not the issue\nhttps://console.cloud.google.com/kubernetes/pod/us-central1-c/instabase-main-prod-002/instabase-prod/deployment-api-server-apps-744cb86fdc-t885k/logs?project=instabase-main",
      "time": "10:56",
      "timestamp": "1629309403.227500",
      "is_reply": true
    },
    {
      "sender": "Anil",
      "user_id": "U01BH8XBR55",
      "message": "cc @lydia @Erick - looks like there is a classifier job whose status call takes forever\ninstabase.com/api/v1/jobs/status?job_id=cdd62abc-11de-4d9a-9f2f-a610102b9777&type=async (http://instabase.com/api/v1/jobs/status?job_id=cdd62abc-11de-4d9a-9f2f-a610102b9777&type=async)\n\nany idea why?\npod restarted again and this was the last heavy thing",
      "time": "11:01",
      "timestamp": "1629309702.227900",
      "is_reply": true
    },
    {
      "sender": "lydia",
      "user_id": "UJK4LKYSJ",
      "message": "is this a new problem or related to the 504 issues Kerry/Shaunak were debugging?",
      "time": "11:03",
      "timestamp": "1629309812.228100",
      "is_reply": true
    },
    {
      "sender": "Anil",
      "user_id": "U01BH8XBR55",
      "message": "^ it is related to above in that this is likely what is crashing api-server-apps :confused: the API endpoints returns  a 61MB long JSON string!! - browser window was stuttering.  Some python parsing thing might be blowing up memory leading to api-server-apps restart.",
      "time": "11:05",
      "timestamp": "1629309923.228300",
      "is_reply": true
    },
    {
      "sender": "Anil",
      "user_id": "U01BH8XBR55",
      "message": "guess it is ok for now - as long as the person who has classifier window open closes it :stuck_out_tongue: otherwise the pod will keep crashing",
      "time": "11:07",
      "timestamp": "1629310041.228600",
      "is_reply": true
    },
    {
      "sender": "Kerry",
      "user_id": "UCX3VGDJR",
      "message": "@lydia this is a new problem",
      "time": "11:14",
      "timestamp": "1629310446.228900",
      "is_reply": true
    },
    {
      "sender": "lydia",
      "user_id": "UJK4LKYSJ",
      "message": "oo yikes. i thought we didn’t return the trained classifier binary to the frontend anymore",
      "time": "11:53",
      "timestamp": "1629312808.229100",
      "is_reply": true
    },
    {
      "sender": "lydia",
      "user_id": "UJK4LKYSJ",
      "message": "i will take a look in a bit",
      "time": "11:53",
      "timestamp": "1629312824.229300",
      "is_reply": true
    },
    {
      "sender": "Travis",
      "user_id": "U017E5NNKAP",
      "message": "this doesn’t have anything to do with my new `api/v1/jobs/bulk_status` endpoint does it?",
      "time": "12:11",
      "timestamp": "1629313898.229500",
      "is_reply": true
    },
    {
      "sender": "Travis",
      "user_id": "U017E5NNKAP",
      "message": "which is only called from Dashboard",
      "time": "12:11",
      "timestamp": "1629313912.229700",
      "is_reply": true
    },
    {
      "sender": "Kerry",
      "user_id": "UCX3VGDJR",
      "message": "nope it’s not afaik",
      "time": "12:27",
      "timestamp": "1629314843.229900",
      "is_reply": true
    },
    {
      "sender": "shaunak",
      "user_id": "UCY6SA014",
      "message": "@Anil still seeing lots of CPU spikes called right after the jobs status API is invoked.  This is resulting in a lot of crashes: [api-server-apps: 24 crashes (https://console.cloud.google.com/kubernetes/pod/us-central1-c/instabase-main-prod-002/instabase-prod/deployment-api-server-apps-744cb86fdc-t885k/details?organizationId=396394272939&project=instabase-main), api-server-apps: 4 crashes (https://console.cloud.google.com/kubernetes/pod/us-central1-c/instabase-main-prod-002/instabase-prod/deployment-api-server-apps-744cb86fdc-57w99/details?organizationId=396394272939&project=instabase-main)].  Overall the health of api-server-apps has not been great since the release as can be observed through some extremely spiky CPU behaviour (https://instabase.com/grafana/d/a164a7f0339f99e89cea5cb47e9be617/kubernetes-compute-resources-workload?orgId=1&refresh=10s&var-datasource=1.+Victoriametrics&var-cluster=&var-namespace=instabase-prod&var-workload=deployment-api-server-apps&var-type=deployment&from=now-6h&to=now).  Can we please look into this tomorrow:",
      "time": "23:04",
      "timestamp": "1629353078.230800",
      "is_reply": true
    }
  ],
  "metadata": {
    "channel_id": "C06FA6A23",
    "channel_name": "discuss-engineering",
    "date_file": "2021-08-18.json",
    "message_count": 38,
    "start_time": "1629304363.221200",
    "end_time": "1629353078.230800",
    "is_thread": true
  }
}