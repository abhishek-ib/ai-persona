{
  "id": "ch_C0516UPPMT3_2023-05-30_1685450314.849459_thread",
  "type": "channel",
  "channel_name": "aihub-feedback",
  "conversation_type": "thread",
  "participants": [
    "Ashish",
    "Eric Han",
    "Xi Cheng",
    "Heymian",
    "Victor Zeng",
    "lenny"
  ],
  "messages": [
    {
      "sender": "lenny",
      "user_id": "U02BTGKFVAR",
      "message": "experienced the same issue with usage credit resetting:",
      "time": "05:38",
      "timestamp": "1685450314.849459",
      "is_reply": false
    },
    {
      "sender": "Eric Han",
      "user_id": "UKPHNU5QE",
      "message": "@Heymian",
      "time": "07:11",
      "timestamp": "1685455916.363529",
      "is_reply": true
    },
    {
      "sender": "Xi Cheng",
      "user_id": "U01F946DGEP",
      "message": "Chances are this has to do with billing? (Matt is OOO, tagging @Victor Zeng for now)",
      "time": "09:11",
      "timestamp": "1685463084.631209",
      "is_reply": true
    },
    {
      "sender": "Victor Zeng",
      "user_id": "U03JT46AUPP",
      "message": "What environment is this taking place in?",
      "time": "11:13",
      "timestamp": "1685470403.214879",
      "is_reply": true
    },
    {
      "sender": "lenny",
      "user_id": "U02BTGKFVAR",
      "message": "aihub.instabase.com (http://aihub.instabase.com) for me",
      "time": "11:13",
      "timestamp": "1685470414.815369",
      "is_reply": true
    },
    {
      "sender": "Victor Zeng",
      "user_id": "U03JT46AUPP",
      "message": "So I spent the last hour or so playing around with the converse app, and I can’t reproduce it. @lenny @Ashish Can you tell me the usernames for the accounts used?",
      "time": "13:46",
      "timestamp": "1685479612.734859",
      "is_reply": true
    },
    {
      "sender": "lenny",
      "user_id": "U02BTGKFVAR",
      "message": "I’m using my instabase account, <mailto:lenny.khazan@instabase.com|lenny.khazan@instabase.com>",
      "time": "13:48",
      "timestamp": "1685479691.880909",
      "is_reply": true
    },
    {
      "sender": "Ashish",
      "user_id": "U3UJ09DJ6",
      "message": "I have two accounts and both experienced this behavior: <mailto:ashishdahiya3@gmail.com|ashishdahiya3@gmail.com> and <mailto:ashish@instabase.com|ashish@instabase.com>",
      "time": "13:49",
      "timestamp": "1685479790.077299",
      "is_reply": true
    },
    {
      "sender": "Victor Zeng",
      "user_id": "U03JT46AUPP",
      "message": "Hmm. I don’t see logs for Lenny’s account, and I only see one successful create trial request for each of Ashish’s accounts.",
      "time": "14:07",
      "timestamp": "1685480825.632349",
      "is_reply": true
    },
    {
      "sender": "lenny",
      "user_id": "U02BTGKFVAR",
      "message": "sorry, you’re right — the issue was on my personal account, <mailto:lenny.khazan@gmail.com|lenny.khazan@gmail.com>",
      "time": "14:08",
      "timestamp": "1685480897.299409",
      "is_reply": true
    },
    {
      "sender": "Victor Zeng",
      "user_id": "U03JT46AUPP",
      "message": "@Yan Wang Do you know if we write-cache usage or if we write it directly to the database?",
      "time": "14:08",
      "timestamp": "1685480910.426269",
      "is_reply": true
    },
    {
      "sender": "Victor Zeng",
      "user_id": "U03JT46AUPP",
      "message": "@lenny Thanks! Only one successful trial license creation for that as well.",
      "time": "14:10",
      "timestamp": "1685481017.726979",
      "is_reply": true
    },
    {
      "sender": "lenny",
      "user_id": "U02BTGKFVAR",
      "message": "I think my total credit count is correct (2500 trial + 2500 from purchase), the problem is that it still says I have all 5000 credits available, while I’ve actually used a lot of them. at one point the usage was correctly reflected in the usage and billing page, but at some point over the last few days it reset to all 5000 credits being unused.",
      "time": "14:12",
      "timestamp": "1685481171.824409",
      "is_reply": true
    },
    {
      "sender": "Victor Zeng",
      "user_id": "U03JT46AUPP",
      "message": "Can you get me the results from this url: https://aihub.instabase.com/api/v2/licenses/usage-summary",
      "time": "14:22",
      "timestamp": "1685481772.698669",
      "is_reply": true
    },
    {
      "sender": "lenny",
      "user_id": "U02BTGKFVAR",
      "message": "```{\"credits_available\": 50000000000, \"license_usage\": [{\"ib_license_id\": \"50757c98-2bc3-4795-b70b-a3962bcc\", \"credits_used\": \"0\", \"product_name\": \"AIHUB\", \"resource_name\": \"OPENAI_TEXT_EMBEDDING_ADA_002_PROMPT_TOKENS\"}, {\"ib_license_id\": \"50757c98-2bc3-4795-b70b-a3962bcc\", \"credits_used\": \"0\", \"product_name\": \"AIHUB\", \"resource_name\": \"OPENAI_GPT_4_PROMPT_TOKENS\"}, {\"ib_license_id\": \"50757c98-2bc3-4795-b70b-a3962bcc\", \"credits_used\": \"0\", \"product_name\": \"AIHUB\", \"resource_name\": \"OPENAI_GPT_4_COMPLETION_TOKENS\"}, {\"ib_license_id\": \"50757c98-2bc3-4795-b70b-a3962bcc\", \"credits_used\": \"0\", \"product_name\": \"AIHUB\", \"resource_name\": \"OPENAI_GPT_3_5_TURBO_PROMPT_TOKENS\"}, {\"ib_license_id\": \"50757c98-2bc3-4795-b70b-a3962bcc\", \"credits_used\": \"0\", \"product_name\": \"AIHUB\", \"resource_name\": \"OPENAI_GPT_3_5_TURBO_COMPLETION_TOKENS\"}, {\"ib_license_id\": \"50757c98-2bc3-4795-b70b-a3962bcc\", \"credits_used\": \"0\", \"product_name\": \"AIHUB\", \"resource_name\": \"OPENAI_TEXT_DAVINCI_003_PROMPT_TOKENS\"}, {\"ib_license_id\": \"50757c98-2bc3-4795-b70b-a3962bcc\", \"credits_used\": \"0\", \"product_name\": \"AIHUB\", \"resource_name\": \"OPENAI_TEXT_DAVINCI_003_COMPLETION_TOKENS\"}]}```",
      "time": "14:24",
      "timestamp": "1685481853.694969",
      "is_reply": true
    },
    {
      "sender": "Victor Zeng",
      "user_id": "U03JT46AUPP",
      "message": "Ok. So usage is in fact being reset.",
      "time": "14:24",
      "timestamp": "1685481876.516729",
      "is_reply": true
    },
    {
      "sender": "Victor Zeng",
      "user_id": "U03JT46AUPP",
      "message": "Interestingly, I see that you don’t have `AIHUB_CONSUMPTION_UNITS` usage.",
      "time": "14:29",
      "timestamp": "1685482193.470849",
      "is_reply": true
    },
    {
      "sender": "Victor Zeng",
      "user_id": "U03JT46AUPP",
      "message": "@lenny @Ashish Did your conversations happen before this PR was deployed? https://github.com/instabase/instabase/pull/41259/files",
      "time": "14:31",
      "timestamp": "1685482273.627089",
      "is_reply": true
    },
    {
      "sender": "Victor Zeng",
      "user_id": "U03JT46AUPP",
      "message": "@lenny This is what I see for your license.",
      "time": "14:49",
      "timestamp": "1685483357.847699",
      "is_reply": true
    },
    {
      "sender": "lenny",
      "user_id": "U02BTGKFVAR",
      "message": "when was that PR deployed to aihub.instabase.com (http://aihub.instabase.com)? the last time I used aihub was during the load test, on 5/25",
      "time": "14:50",
      "timestamp": "1685483449.697509",
      "is_reply": true
    },
    {
      "sender": "Victor Zeng",
      "user_id": "U03JT46AUPP",
      "message": "Looks like May 26.",
      "time": "14:57",
      "timestamp": "1685483823.776279",
      "is_reply": true
    },
    {
      "sender": "Heymian",
      "user_id": "UADQ9V8PK",
      "message": "Oh that’s correct, I think I remember discussing this with Matt, that when the switch to the new billing policy happened (from tokens to pages) we would have to reset the usage since the license is a new one. It was easier to just reset all the entries than to try to migrate the existing token licenses to page.\n\nSo it sounds like this is something that happened just the once? And it’s not repeatedly resetting itself?",
      "time": "15:29",
      "timestamp": "1685485776.236999",
      "is_reply": true
    },
    {
      "sender": "lenny",
      "user_id": "U02BTGKFVAR",
      "message": "I’ve only seen it happen this one time, so that would make sense to me",
      "time": "15:30",
      "timestamp": "1685485804.608629",
      "is_reply": true
    },
    {
      "sender": "Victor Zeng",
      "user_id": "U03JT46AUPP",
      "message": "Yep!\n\nFull explanation:\n\nCredit usage is computed (https://github.com/instabase/instabase/blob/master/shared-utils/go-utils/src/instabase/utils/db/accessor/license_metrics_util.go#L111) dynamically by multiplying the resource cost and how much the resource was used. Originally, when we used per-token pricing, we tracked usage using the `*_TOKENS` resources. When we switched to the current pricing model, we set the cost for the old `*_TOKENS` resources to 0 and introduced the `AIHUB_CONSUMPTION_UNITS` resource. As a result, all usage prior to the change counted as 0 usage.",
      "time": "15:31",
      "timestamp": "1685485917.049729",
      "is_reply": true
    },
    {
      "sender": "lenny",
      "user_id": "U02BTGKFVAR",
      "message": "makes sense, thanks for the explanation victor!",
      "time": "15:32",
      "timestamp": "1685485937.835599",
      "is_reply": true
    },
    {
      "sender": "Victor Zeng",
      "user_id": "U03JT46AUPP",
      "message": "So this is a one-time thing, and we can close out the jira ticket. :slightly_smiling_face:",
      "time": "15:35",
      "timestamp": "1685486122.161089",
      "is_reply": true
    },
    {
      "sender": "Heymian",
      "user_id": "UADQ9V8PK",
      "message": "Yup, victor, after you put the details into the ticket, feel free to close it out! thanks for looking into this!",
      "time": "15:36",
      "timestamp": "1685486178.757749",
      "is_reply": true
    },
    {
      "sender": "Ashish",
      "user_id": "U3UJ09DJ6",
      "message": "thanks Victor!",
      "time": "23:45",
      "timestamp": "1685515501.003179",
      "is_reply": true
    }
  ],
  "metadata": {
    "channel_id": "C0516UPPMT3",
    "channel_name": "aihub-feedback",
    "date_file": "2023-05-30.json",
    "message_count": 28,
    "start_time": "1685450314.849459",
    "end_time": "1685515501.003179",
    "is_thread": true
  }
}