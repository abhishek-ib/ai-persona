{
  "id": "ch_C06FA6A23_2025-03-25_1742909693.865319_thread",
  "type": "channel",
  "channel_name": "discuss-engineering",
  "conversation_type": "thread",
  "participants": [
    "Paul H",
    "jordy.vlan",
    "Serena"
  ],
  "messages": [
    {
      "sender": "jordy.vlan",
      "user_id": "U072CDMB4N8",
      "message": "Hi team!\n\nI am working on a new feature in Build to allow users to specify the data type of the extracted fields (JSON, TABLE, etc.).\nAn important change is that we need to update the `result_data_type`  in the payload to model-service.\nI have a branch with the backend changes here: https://github.com/instabase/instabase/pull/69042\n\nIn ibllm, everything is working as expected, yet I fail to make the unit tests in `celery-app-tasks` pass, mainly because of the absence of the field `result_data_type` in the preconfigured refiner test data, eg:\nTest: `FAIL: test_generate_refiner_json_requested_fields (instabase_unit_tests.instabase.tasks.apps.test_aihub_refiner_util.TestAIHubRefinerUtils)`\nwhich loads the implied ground truth refiner json from `refiner_program.json`\n\nNow I could add the `result_data_type=ResultDataTypes.TEXT` to all the individual fields in the test data, but I am not sure if this is the right approach.\nAnother approach I considered is to alter the `FieldPrompt`, which is a `TypedDict`, to include the `result_data_type` field as a `NotRequired[ResultDataTypes]` field.\nThis would be possible with `typing_extensions>4.0.0`, but wondering if this is the right approach (and if this plays well with the DB etc.). When doing `poetry add typing-extensions`, it complains that it cannot find it when running the tests, while it should be using the right poetry env (or which `pyproject.toml` s (likely plural) should I be updating for testing this?)  I am open to any suggestions you might have.\n\nAlso, when running `celery-app-tasks` locally (`make test 2>&1 | tee test_output_$(date +%Y%m%d_%H%M%S).log`), I get the following errors, related to missing `imagemagick` packages, while it is installed. Any hints on how to fix this?\n```ERROR: instabase_unit_tests.instabase.tasks.apps.test_aihub_tasks (unittest.loader._FailedTest)\n  File \"/Users/jvl/Library/Caches/pypoetry/virtualenvs/celery-app-tasks-QBbyg0-S-py3.9/lib/python3.9/site-packages/wand/api.py\", line 178, in <module>\n    raise ImportError('MagickWand shared library not found.\\n'\nImportError: MagickWand shared library not found.\nYou probably had not installed ImageMagick library.\nTry to install:\n  brew install freetype imagemagick```\nThanks! :prayge:",
      "time": "06:34",
      "timestamp": "1742909693.865319",
      "is_reply": false
    },
    {
      "sender": "jordy.vlan",
      "user_id": "U072CDMB4N8",
      "message": "cc: @pauline.comising",
      "time": "06:35",
      "timestamp": "1742909702.353209",
      "is_reply": true
    },
    {
      "sender": "jordy.vlan",
      "user_id": "U072CDMB4N8",
      "message": "on the latter point, only appears to trigger locally, so non-urgent / can ignore",
      "time": "07:05",
      "timestamp": "1742911543.955859",
      "is_reply": true
    },
    {
      "sender": "Paul H",
      "user_id": "U011UPRAPNV",
      "message": "cc @tony.shi you've seen this imagemagick issue before, right?",
      "time": "07:54",
      "timestamp": "1742914440.146549",
      "is_reply": true
    },
    {
      "sender": "Serena",
      "user_id": "U01CZ3LBFU4",
      "message": "> Now I could add the `result_data_type=ResultDataTypes.TEXT` to all the individual fields in the test data, but I am not sure if this is the right approach.\nthe CI error is occurring because the expected data for the unit tests was not updated\n\ni see that you've already added `result_data_type` to each instance of expected data in your PR (https://github.com/instabase/instabase/pull/69042/commits/4a0ba97b5d21d36c7e26ab544ca35e19f18c7565), which has resolved the CI issues :tada:",
      "time": "15:38",
      "timestamp": "1742942303.262879",
      "is_reply": true
    },
    {
      "sender": "Serena",
      "user_id": "U01CZ3LBFU4",
      "message": "for the `imagemagick` issue, based on the suggestion to `brew install freetype imagemagick`, i assume this isn't a problem in your crafting sandbox?\n\nif it is a problem on your crafting sandbox, i think we may want to add `imagemagick` as something installed in the `ibdev-backend` template",
      "time": "15:46",
      "timestamp": "1742942795.962089",
      "is_reply": true
    },
    {
      "sender": "jordy.vlan",
      "user_id": "U072CDMB4N8",
      "message": "Not crafting-specific, only local :)",
      "time": "15:50",
      "timestamp": "1742943004.618929",
      "is_reply": true
    },
    {
      "sender": "jordy.vlan",
      "user_id": "U072CDMB4N8",
      "message": "@Serena yeah I was trying to avoid having to update all unit tests, but seemed unavoidable so did it anyway :)",
      "time": "15:50",
      "timestamp": "1742943048.966549",
      "is_reply": true
    },
    {
      "sender": "Serena",
      "user_id": "U01CZ3LBFU4",
      "message": "yeah unfortunately, the expected data did need to be updated in this case :sweat_smile:",
      "time": "15:58",
      "timestamp": "1742943522.426249",
      "is_reply": true
    }
  ],
  "metadata": {
    "channel_id": "C06FA6A23",
    "channel_name": "discuss-engineering",
    "date_file": "2025-03-25.json",
    "message_count": 9,
    "start_time": "1742909693.865319",
    "end_time": "1742943522.426249",
    "is_thread": true
  }
}