{
  "id": "ch_C05L87V014J_2025-05-14_1747265359.458429_thread",
  "type": "channel",
  "channel_name": "ask-crafting",
  "conversation_type": "thread",
  "participants": [
    "neerad.phansalkar",
    "mfichman",
    "Vasu"
  ],
  "messages": [
    {
      "sender": "mfichman",
      "user_id": "U03DZ9XUE10",
      "message": "Hi there @Gaurav Saini -- noticed that weaviate requests during search indexing started failing in Crafting sandboxes. I think this is b/c the Crafting sandboxes are still using the old weaviate container, and not weaviate-titan. Here's an example error that @neerad.phansalkar found:\n\n```level=ERROR time=2025-05-14 22:44:22,970 msg=\"Traceback: Traceback (most recent call last):\n  File \"/model-service/py/instabase/ibllm/model/tasks/add_to_index_search.py\", line 52, in add_to_index_search\n    adapter = VectorStoreAdapter.create(\n  File \"/model-service/py/instabase/ibllm/code_labs/helpers/vector_store/adapter.py\", line 72, in create\n    return cls(schema_type, index_name, config)\n  File \"/model-service/py/instabase/ibllm/code_labs/helpers/vector_store/adapter.py\", line 40, in __init__\n    self._connector: BaseVectorDBConnector = connector_v3.WeaviateConnector()\n  File \"/model-service/py/instabase/ibllm/code_labs/helpers/vector_store/weaviate/connector_v3.py\", line 31, in __init__\n    self.client: weaviate.Client = weaviate.Client(url=f'http://{host}:{port}')\n  File \"/usr/local/lib/python3.9/site-packages/weaviate/client.py\", line 150, in __init__\n    self._connection = Connection(\n  File \"/usr/local/lib/python3.9/site-packages/weaviate/connect/connection.py\", line 167, in __init__\n    self._server_version = self.get_meta()[\"version\"]\n  File \"/usr/local/lib/python3.9/site-packages/weaviate/connect/connection.py\", line 662, in get_meta\n    res = _decode_json_response_dict(response, \"Meta endpoint\")\n  File \"/usr/local/lib/python3.9/site-packages/weaviate/util.py\", line 803, in _decode_json_response_dict\n    raise UnexpectedStatusCodeException(location, response)\nweaviate.exceptions.UnexpectedStatusCodeException: Meta endpoint! Unexpected status code: 400, with response body: None.\n\"  path=\"/model-service/py/instabase/ibllm/model/tasks/add_to_index_search.py:87\" process=\"MainProcess\" thread=\"ThreadPoolExecutor-22_0\" trace_id=\"f2ef22aa5bc579d4\" exception=\"Traceback (most recent call last):\n  File \"/model-service/py/instabase/ibllm/model/tasks/add_to_index_search.py\", line 52, in add_to_index_search\n    adapter = VectorStoreAdapter.create(\n  File \"/model-service/py/instabase/ibllm/code_labs/helpers/vector_store/adapter.py\", line 72, in create\n    return cls(schema_type, index_name, config)\n  File \"/model-service/py/instabase/ibllm/code_labs/helpers/vector_store/adapter.py\", line 40, in __init__\n    self._connector: BaseVectorDBConnector = connector_v3.WeaviateConnector()\n  File \"/model-service/py/instabase/ibllm/code_labs/helpers/vector_store/weaviate/connector_v3.py\", line 31, in __init__\n    self.client: weaviate.Client = weaviate.Client(url=f'http://{host}:{port}')\n  File \"/usr/local/lib/python3.9/site-packages/weaviate/client.py\", line 150, in __init__\n    self._connection = Connection(\n  File \"/usr/local/lib/python3.9/site-packages/weaviate/connect/connection.py\", line 167, in __init__\n    self._server_version = self.get_meta()[\"version\"]\n  File \"/usr/local/lib/python3.9/site-packages/weaviate/connect/connection.py\", line 662, in get_meta\n    res = _decode_json_response_dict(response, \"Meta endpoint\")\n  File \"/usr/local/lib/python3.9/site-packages/weaviate/util.py\", line 803, in _decode_json_response_dict\n    raise UnexpectedStatusCodeException(location, response)\nweaviate.exceptions.UnexpectedStatusCodeException: Meta endpoint! Unexpected status code: 400, with response body: None.\"\nlevel=INFO time=2025-05-14 22:44:22,971 msg=\"IBLLM executed add_to_index_search in 0.0970 seconds\" trace_id=\"f2ef22aa5bc579d4\" path=\"/model-service/py/instabase/ibllm/model/observability/logging/utils.py:97\" process=\"MainProcess\" thread=\"ThreadPoolExecutor-22_0\" trace_id=\"f2ef22aa5bc579d4\"\nlevel=INFO time=2025-05-14 22:44:22,971 msg=\"Finished IBLLM request for task: add_to_index_search with ERROR: Exception Meta endpoint! Unexpected status code: 400, with response body: None.\"  path=\"/model-service/py/instabase/ibllm/model/model.py:286\" process=\"MainProcess\" thread=\"ThreadPoolExecutor-22_0\" trace_id=\"f2ef22aa5bc579d4\"```",
      "time": "16:29",
      "timestamp": "1747265359.458429",
      "is_reply": false
    },
    {
      "sender": "mfichman",
      "user_id": "U03DZ9XUE10",
      "message": "We're going to try to fix it by using weaviate-titan in Crafting sandboxes, but can you also take a look in the AM?",
      "time": "16:29",
      "timestamp": "1747265381.652589",
      "is_reply": true
    },
    {
      "sender": "mfichman",
      "user_id": "U03DZ9XUE10",
      "message": "Possible fix:\n\n\nhttps://github.com/instabase/instabase/pull/70679\n\nStill having some issues though; @neerad.phansalkar will update here",
      "time": "16:43",
      "timestamp": "1747266227.068019",
      "is_reply": true
    },
    {
      "sender": "neerad.phansalkar",
      "user_id": "U08K6KE6R54",
      "message": "After running weaviate-titan instead of weaviate in my crafting, we now observe this error:\n```level=ERROR time=2025-05-14 23:42:56,276 msg=\"Error deleting objects from index IB_ENTERPRISE_SEARCH_0196d12d_1007_7625_af0d_a0bdbc153e75 for schema search: Delete in batch! Unexpected status code: 500, with response body: {'error': [{'message': 'batch delete objects: cannot find objects: find matching doc ids in shard \"IB_ENTERPRISE_SEARCH_0196d12d_1007_7625_af0d_a0bdbc153e75\": get/init local shard \"IB_ENTERPRISE_SEARCH_0196d12d_1007_7625_af0d_a0bdbc153e75\", no shutdown: LazyLoadShard::preventShutdown: Unable to load shard IB_ENTERPRISE_SEARCH_0196d12d_1007_7625_af0d_a0bdbc153e75: init shard \"search_IB_ENTERPRISE_SEARCH_0196d12d_1007_7625_af0d_a0bdbc153e75\": dynamic index: the dynamic index can only be created under async indexing environment'}]}.\"  path=\"/model-service/py/instabase/ibllm/code_labs/helpers/vector_store/weaviate/connector_v3.py:455\" process=\"MainProcess\" thread=\"ThreadPoolExecutor-41_0\" trace_id=\"3c5558ff35163914\" exception=\"Traceback (most recent call last):\n  File \"/model-service/py/instabase/ibllm/code_labs/helpers/vector_store/weaviate/connector_v3.py\", line 442, in delete_objects\n    result = self.client.batch.delete_objects(\n  File \"/usr/local/lib/python3.9/site-packages/weaviate/batch/crud_batch.py\", line 1376, in delete_objects\n    res = _decode_json_response_dict(response, \"Delete in batch\")\n  File \"/usr/local/lib/python3.9/site-packages/weaviate/util.py\", line 803, in _decode_json_response_dict\n    raise UnexpectedStatusCodeException(location, response)\nweaviate.exceptions.UnexpectedStatusCodeException: Delete in batch! Unexpected status code: 500, with response body: {'error': [{'message': 'batch delete objects: cannot find objects: find matching doc ids in shard \"IB_ENTERPRISE_SEARCH_0196d12d_1007_7625_af0d_a0bdbc153e75\": get/init local shard \"IB_ENTERPRISE_SEARCH_0196d12d_1007_7625_af0d_a0bdbc153e75\", no shutdown: LazyLoadShard::preventShutdown: Unable to load shard IB_ENTERPRISE_SEARCH_0196d12d_1007_7625_af0d_a0bdbc153e75: init shard \"search_IB_ENTERPRISE_SEARCH_0196d12d_1007_7625_af0d_a0bdbc153e75\": dynamic index: the dynamic index can only be created under async indexing environment'}]}.\"\nlevel=ERROR time=2025-05-14 23:42:57,285 msg=\"Error deleting objects from index IB_ENTERPRISE_SEARCH_0196d12d_1007_7625_af0d_a0bdbc153e75 for schema search: Delete in batch! Unexpected status code: 500, with response body: {'error': [{'message': 'batch delete objects: cannot find objects: find matching doc ids in shard \"IB_ENTERPRISE_SEARCH_0196d12d_1007_7625_af0d_a0bdbc153e75\": get/init local shard \"IB_ENTERPRISE_SEARCH_0196d12d_1007_7625_af0d_a0bdbc153e75\", no shutdown: LazyLoadShard::preventShutdown: Unable to load shard IB_ENTERPRISE_SEARCH_0196d12d_1007_7625_af0d_a0bdbc153e75: init shard \"search_IB_ENTERPRISE_SEARCH_0196d12d_1007_7625_af0d_a0bdbc153e75\": dynamic index: the dynamic index can only be created under async indexing environment'}]}.\"  path=\"/model-service/py/instabase/ibllm/code_labs/helpers/vector_store/weaviate/connector_v3.py:455\" process=\"MainProcess\" thread=\"ThreadPoolExecutor-41_0\" trace_id=\"3c5558ff35163914\" exception=\"Traceback (most recent call last):\n  File \"/model-service/py/instabase/ibllm/code_labs/helpers/vector_store/weaviate/connector_v3.py\", line 442, in delete_objects\n    result = self.client.batch.delete_objects(\n  File \"/usr/local/lib/python3.9/site-packages/weaviate/batch/crud_batch.py\", line 1376, in delete_objects\n    res = _decode_json_response_dict(response, \"Delete in batch\")\n  File \"/usr/local/lib/python3.9/site-packages/weaviate/util.py\", line 803, in _decode_json_response_dict\n    raise UnexpectedStatusCodeException(location, response)\nweaviate.exceptions.UnexpectedStatusCodeException: Delete in batch! Unexpected status code: 500, with response body: {'error': [{'message': 'batch delete objects: cannot find objects: find matching doc ids in shard \"IB_ENTERPRISE_SEARCH_0196d12d_1007_7625_af0d_a0bdbc153e75\": get/init local shard \"IB_ENTERPRISE_SEARCH_0196d12d_1007_7625_af0d_a0bdbc153e75\", no shutdown: LazyLoadShard::preventShutdown: Unable to load shard IB_ENTERPRISE_SEARCH_0196d12d_1007_7625_af0d_a0bdbc153e75: init shard \"search_IB_ENTERPRISE_SEARCH_0196d12d_1007_7625_af0d_a0bdbc153e75\": dynamic index: the dynamic index can only be created under async indexing environment'}]}.\"\nlevel=ERROR time=2025-05-14 23:42:59,290 msg=\"Error deleting objects from index IB_ENTERPRISE_SEARCH_0196d12d_1007_7625_af0d_a0bdbc153e75 for schema search: Delete in batch! Unexpected status code: 500, with response body: {'error': [{'message': 'batch delete objects: cannot find objects: find matching doc ids in shard \"IB_ENTERPRISE_SEARCH_0196d12d_1007_7625_af0d_a0bdbc153e75\": get/init local shard \"IB_ENTERPRISE_SEARCH_0196d12d_1007_7625_af0d_a0bdbc153e75\", no shutdown: LazyLoadShard::preventShutdown: Unable to load shard IB_ENTERPRISE_SEARCH_0196d12d_1007_7625_af0d_a0bdbc153e75: init shard \"search_IB_ENTERPRISE_SEARCH_0196d12d_1007_7625_af0d_a0bdbc153e75\": dynamic index: the dynamic index can only be created under async indexing environment'}]}.\"  path=\"/model-service/py/instabase/ibllm/code_labs/helpers/vector_store/weaviate/connector_v3.py:455\" process=\"MainProcess\" thread=\"ThreadPoolExecutor-41_0\" trace_id=\"3c5558ff35163914\" exception=\"Traceback (most recent call last):\n  File \"/model-service/py/instabase/ibllm/code_labs/helpers/vector_store/weaviate/connector_v3.py\", line 442, in delete_objects\n    result = self.client.batch.delete_objects(\n  File \"/usr/local/lib/python3.9/site-packages/weaviate/batch/crud_batch.py\", line 1376, in delete_objects\n    res = _decode_json_response_dict(response, \"Delete in batch\")\n  File \"/usr/local/lib/python3.9/site-packages/weaviate/util.py\", line 803, in _decode_json_response_dict\n    raise UnexpectedStatusCodeException(location, response)\nweaviate.exceptions.UnexpectedStatusCodeException: Delete in batch! Unexpected status code: 500, with response body: {'error': [{'message': 'batch delete objects: cannot find objects: find matching doc ids in shard \"IB_ENTERPRISE_SEARCH_0196d12d_1007_7625_af0d_a0bdbc153e75\": get/init local shard \"IB_ENTERPRISE_SEARCH_0196d12d_1007_7625_af0d_a0bdbc153e75\", no shutdown: LazyLoadShard::preventShutdown: Unable to load shard IB_ENTERPRISE_SEARCH_0196d12d_1007_7625_af0d_a0bdbc153e75: init shard \"search_IB_ENTERPRISE_SEARCH_0196d12d_1007_7625_af0d_a0bdbc153e75\": dynamic index: the dynamic index can only be created under async indexing environment'}]}.\"\nlevel=ERROR time=2025-05-14 23:43:03,297 msg=\"Error deleting objects from index IB_ENTERPRISE_SEARCH_0196d12d_1007_7625_af0d_a0bdbc153e75 for schema search: Delete in batch! Unexpected status code: 500, with response body: {'error': [{'message': 'batch delete objects: cannot find objects: find matching doc ids in shard \"IB_ENTERPRISE_SEARCH_0196d12d_1007_7625_af0d_a0bdbc153e75\": get/init local shard \"IB_ENTERPRISE_SEARCH_0196d12d_1007_7625_af0d_a0bdbc153e75\", no shutdown: LazyLoadShard::preventShutdown: Unable to load shard IB_ENTERPRISE_SEARCH_0196d12d_1007_7625_af0d_a0bdbc153e75: init shard \"search_IB_ENTERPRISE_SEARCH_0196d12d_1007_7625_af0d_a0bdbc153e75\": dynamic index: the dynamic index can only be created under async indexing environment'}]}.\"  path=\"/model-service/py/instabase/ibllm/code_labs/helpers/vector_store/weaviate/connector_v3.py:455\" process=\"MainProcess\" thread=\"ThreadPoolExecutor-41_0\" trace_id=\"3c5558ff35163914\" exception=\"Traceback (most recent call last):\n  File \"/model-service/py/instabase/ibllm/code_labs/helpers/vector_store/weaviate/connector_v3.py\", line 442, in delete_objects\n    result = self.client.batch.delete_objects(\n  File \"/usr/local/lib/python3.9/site-packages/weaviate/batch/crud_batch.py\", line 1376, in delete_objects\n    res = _decode_json_response_dict(response, \"Delete in batch\")\n  File \"/usr/local/lib/python3.9/site-packages/weaviate/util.py\", line 803, in _decode_json_response_dict\n    raise UnexpectedStatusCodeException(location, response)\nweaviate.exceptions.UnexpectedStatusCodeException: Delete in batch! Unexpected status code: 500, with response body: {'error': [{'message': 'batch delete objects: cannot find objects: find matching doc ids in shard \"IB_ENTERPRISE_SEARCH_0196d12d_1007_7625_af0d_a0bdbc153e75\": get/init local shard \"IB_ENTERPRISE_SEARCH_0196d12d_1007_7625_af0d_a0bdbc153e75\", no shutdown: LazyLoadShard::preventShutdown: Unable to load shard IB_ENTERPRISE_SEARCH_0196d12d_1007_7625_af0d_a0bdbc153e75: init shard \"search_IB_ENTERPRISE_SEARCH_0196d12d_1007_7625_af0d_a0bdbc153e75\": dynamic index: the dynamic index can only be created under async indexing environment'}]}.\"\nlevel=ERROR time=2025-05-14 23:43:11,308 msg=\"Error deleting objects from index IB_ENTERPRISE_SEARCH_0196d12d_1007_7625_af0d_a0bdbc153e75 for schema search: Delete in batch! Unexpected status code: 500, with response body: {'error': [{'message': 'batch delete objects: cannot find objects: find matching doc ids in shard \"IB_ENTERPRISE_SEARCH_0196d12d_1007_7625_af0d_a0bdbc153e75\": get/init local shard \"IB_ENTERPRISE_SEARCH_0196d12d_1007_7625_af0d_a0bdbc153e75\", no shutdown: LazyLoadShard::preventShutdown: Unable to load shard IB_ENTERPRISE_SEARCH_0196d12d_1007_7625_af0d_a0bdbc153e75: init shard \"search_IB_ENTERPRISE_SEARCH_0196d12d_1007_7625_af0d_a0bdbc153e75\": dynamic index: the dynamic index can only be created under async indexing environment'}]}.\"  path=\"/model-service/py/instabase/ibllm/code_labs/helpers/vector_store/weaviate/connector_v3.py:455\" process=\"MainProcess\" thread=\"ThreadPoolExecutor-41_0\" trace_id=\"3c5558ff35163914\" exception=\"Traceback (most recent call last):\n  File \"/model-service/py/instabase/ibllm/code_labs/helpers/vector_store/weaviate/connector_v3.py\", line 442, in delete_objects\n    result = self.client.batch.delete_objects(\n  File \"/usr/local/lib/python3.9/site-packages/weaviate/batch/crud_batch.py\", line 1376, in delete_objects\n    res = _decode_json_response_dict(response, \"Delete in batch\")\n  File \"/usr/local/lib/python3.9/site-packages/weaviate/util.py\", line 803, in _decode_json_response_dict\n    raise UnexpectedStatusCodeException(location, response)\nweaviate.exceptions.UnexpectedStatusCodeException: Delete in batch! Unexpected status code: 500, with response body: {'error': [{'message': 'batch delete objects: cannot find objects: find matching doc ids in shard \"IB_ENTERPRISE_SEARCH_0196d12d_1007_7625_af0d_a0bdbc153e75\": get/init local shard \"IB_ENTERPRISE_SEARCH_0196d12d_1007_7625_af0d_a0bdbc153e75\", no shutdown: LazyLoadShard::preventShutdown: Unable to load shard IB_ENTERPRISE_SEARCH_0196d12d_1007_7625_af0d_a0bdbc153e75: init shard \"search_IB_ENTERPRISE_SEARCH_0196d12d_1007_7625_af0d_a0bdbc153e75\": dynamic index: the dynamic index can only be created under async indexing environment'}]}.\"```",
      "time": "16:45",
      "timestamp": "1747266346.417939",
      "is_reply": true
    },
    {
      "sender": "Vasu",
      "user_id": "U02RJRBS13R",
      "message": "I'll take a look at what can be done for this today, there a few configurations that we need to change to allow it to work! Like enabling async_indexing, disabling autoschema etc.",
      "time": "20:45",
      "timestamp": "1747280705.394489",
      "is_reply": true
    },
    {
      "sender": "Vasu",
      "user_id": "U02RJRBS13R",
      "message": "While I figure out a permanent solution, the below attached docker-compose can be used as a stop gap solution!",
      "time": "20:52",
      "timestamp": "1747281165.499089",
      "is_reply": true
    },
    {
      "sender": "Vasu",
      "user_id": "U02RJRBS13R",
      "message": "@mfichman @Gaurav Saini PR for the above - https://github.com/instabase/instabase/pull/70684! Could you please help with a review?",
      "time": "23:27",
      "timestamp": "1747290475.332189",
      "is_reply": true
    }
  ],
  "metadata": {
    "channel_id": "C05L87V014J",
    "channel_name": "ask-crafting",
    "date_file": "2025-05-14.json",
    "message_count": 7,
    "start_time": "1747265359.458429",
    "end_time": "1747290475.332189",
    "is_thread": true
  }
}