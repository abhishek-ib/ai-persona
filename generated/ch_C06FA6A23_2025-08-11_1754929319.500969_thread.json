{
  "id": "ch_C06FA6A23_2025-08-11_1754929319.500969_thread",
  "type": "channel",
  "channel_name": "discuss-engineering",
  "conversation_type": "thread",
  "participants": [
    "Jason",
    "Abhinav",
    "Anil"
  ],
  "messages": [
    {
      "sender": "Anil",
      "user_id": "U01BH8XBR55",
      "message": "@Abhinav is this something you can help setup",
      "time": "09:21",
      "timestamp": "1754929319.500969",
      "is_reply": false
    },
    {
      "sender": "Anil",
      "user_id": "U01BH8XBR55",
      "message": "I want to switch over to VertexAI this week",
      "time": "09:22",
      "timestamp": "1754929334.996019",
      "is_reply": true
    },
    {
      "sender": "Anil",
      "user_id": "U01BH8XBR55",
      "message": "If you can help set this up - will use this method",
      "time": "09:22",
      "timestamp": "1754929352.941849",
      "is_reply": true
    },
    {
      "sender": "Anil",
      "user_id": "U01BH8XBR55",
      "message": "I have a version with service account working - got it from @Jason",
      "time": "09:22",
      "timestamp": "1754929372.216349",
      "is_reply": true
    },
    {
      "sender": "Abhinav",
      "user_id": "U03V2G5L19A",
      "message": "Do you need it just for a test sandbox or for all of SaaS?",
      "time": "09:24",
      "timestamp": "1754929451.172529",
      "is_reply": true
    },
    {
      "sender": "Anil",
      "user_id": "U01BH8XBR55",
      "message": "For now, we need it on aihub-sandbox, aihub-uat and aihub mt prod",
      "time": "09:24",
      "timestamp": "1754929485.706449",
      "is_reply": true
    },
    {
      "sender": "Anil",
      "user_id": "U01BH8XBR55",
      "message": "At a later date (unspecified at this time) all environments",
      "time": "09:24",
      "timestamp": "1754929496.301839",
      "is_reply": true
    },
    {
      "sender": "Abhinav",
      "user_id": "U03V2G5L19A",
      "message": "ok. lets start with aihub-sandbox. Which google project are you using ?",
      "time": "09:27",
      "timestamp": "1754929654.754399",
      "is_reply": true
    },
    {
      "sender": "Anil",
      "user_id": "U01BH8XBR55",
      "message": "I am using instabase-dev",
      "time": "09:28",
      "timestamp": "1754929683.388039",
      "is_reply": true
    },
    {
      "sender": "Jason",
      "user_id": "U02JRG6MNBS",
      "message": "@Abhinav if helpful, here is the example https://github.com/instabase/ib-deployments/tree/main/resources/vertextai",
      "time": "09:37",
      "timestamp": "1754930229.451649",
      "is_reply": true
    },
    {
      "sender": "Jason",
      "user_id": "U02JRG6MNBS",
      "message": "I actually used https://github.com/instabase/ib-deployments/blob/main/resources/vertextai/vertex_example.py for the simple test",
      "time": "09:37",
      "timestamp": "1754930251.446709",
      "is_reply": true
    },
    {
      "sender": "Jason",
      "user_id": "U02JRG6MNBS",
      "message": "@Abhinav not documented, but I also may have needed to set these env vars\n\nexport GOOGLE_GENAI_USE_VERTEXAI=true\nexport GOOGLE_CLOUD_PROJECT='instabase-dev'\nexport GOOGLE_CLOUD_LOCATION='us-central1'",
      "time": "09:42",
      "timestamp": "1754930530.111919",
      "is_reply": true
    },
    {
      "sender": "Jason",
      "user_id": "U02JRG6MNBS",
      "message": "in addition to: export GOOGLE_APPLICATION_CREDENTIALS=./instabase-dev-4634f82778c8.json",
      "time": "09:42",
      "timestamp": "1754930553.332759",
      "is_reply": true
    },
    {
      "sender": "Jason",
      "user_id": "U02JRG6MNBS",
      "message": "the later would obviously point to a volume mount",
      "time": "09:42",
      "timestamp": "1754930573.401699",
      "is_reply": true
    },
    {
      "sender": "Abhinav",
      "user_id": "U03V2G5L19A",
      "message": "which ib service will call the gcp apis ?",
      "time": "09:56",
      "timestamp": "1754931410.512379",
      "is_reply": true
    },
    {
      "sender": "Anil",
      "user_id": "U01BH8XBR55",
      "message": "api-server and celery-app-tasks",
      "time": "09:57",
      "timestamp": "1754931431.778179",
      "is_reply": true
    },
    {
      "sender": "Abhinav",
      "user_id": "U03V2G5L19A",
      "message": "api-server and celery-app-tasks service accounts  in aihub-sandbox have same access now. You can try it out after removing hardcoded creds",
      "time": "10:09",
      "timestamp": "1754932145.982799",
      "is_reply": true
    },
    {
      "sender": "Anil",
      "user_id": "U01BH8XBR55",
      "message": "awesome :pray:",
      "time": "10:19",
      "timestamp": "1754932792.025469",
      "is_reply": true
    },
    {
      "sender": "Anil",
      "user_id": "U01BH8XBR55",
      "message": "how does it actually work / how do I test this? if you have any pointers that would be great",
      "time": "10:20",
      "timestamp": "1754932823.899289",
      "is_reply": true
    },
    {
      "sender": "Abhinav",
      "user_id": "U03V2G5L19A",
      "message": "the working version you have is it the local test what Jason shared or from within aihub-sandbox ?",
      "time": "10:21",
      "timestamp": "1754932905.376469",
      "is_reply": true
    },
    {
      "sender": "Anil",
      "user_id": "U01BH8XBR55",
      "message": "It is on local. I was planning to implement something similar on aihub-sandbox.",
      "time": "10:22",
      "timestamp": "1754932940.693849",
      "is_reply": true
    },
    {
      "sender": "Anil",
      "user_id": "U01BH8XBR55",
      "message": "The docai version on sandbox still calls gemini API directly and not the gemini API on vertex AI",
      "time": "10:22",
      "timestamp": "1754932966.398369",
      "is_reply": true
    },
    {
      "sender": "Abhinav",
      "user_id": "U03V2G5L19A",
      "message": ":eyes:",
      "time": "12:38",
      "timestamp": "1754941093.161689",
      "is_reply": true
    },
    {
      "sender": "Abhinav",
      "user_id": "U03V2G5L19A",
      "message": "```apiVersion: v1\nkind: Pod\nmetadata:\n  labels:\n    run: gcloud-test\n  name: gcloud-test\n  namespace: insan-use2-aihub-sandbox-instabase\nspec:\n  containers:\n  - name: example\n    image: google/cloud-sdk:alpine\n    command: [\"/bin/sh\", \"-c\", \"gcloud config set project instabase-dev && gcloud auth login --cred-file $GOOGLE_APPLICATION_CREDENTIALS &&  gcloud auth list\"]\n    volumeMounts:\n    - name: token\n      mountPath: \"/var/run/service-account\"\n      readOnly: true\n    - name: workload-identity-credential-configuration\n      mountPath: \"/etc/workload-identity\"\n      readOnly: true\n    env:\n    - name: GOOGLE_APPLICATION_CREDENTIALS\n      value: \"/etc/workload-identity/credential-configuration.json\"\n    - name: GOOGLE_CLOUD_LOCATION\n      value: us-central1\n  serviceAccountName: api-server-sa\n  volumes:\n  - name: token\n    projected:\n      sources:\n      - serviceAccountToken:\n          audience: https://iam.googleapis.com/projects/666216188190/locations/global/workloadIdentityPools/instabase-dev-vertex-ai-pool/providers/instabase-dev-vertex-ai-provider\n          expirationSeconds: 3600\n          path: token\n  - name: workload-identity-credential-configuration\n    configMap:\n      name: gcp-creds-config```\nThis pod has access to  vertex AI role in GCP.\n\nYou will need volumes/mounts and env vars specified above\n\nmounted cm is config and not a secret with this value. This is already created in aihub-sandbox.\n```{\n  \"type\": \"external_account\",\n  \"audience\": \"//iam.googleapis.com/projects/666216188190/locations/global/workloadIdentityPools/instabase-dev-vertex-ai-pool/providers/instabase-dev-vertex-ai-provider\",\n  \"subject_token_type\": \"urn:ietf:params:oauth:token-type:jwt\",\n  \"token_url\": \"https://sts.googleapis.com/v1/token\",\n  \"credential_source\": {\n    \"file\": \"/var/run/service-account/token\",\n    \"format\": {\n      \"type\": \"text\"\n    }\n  }\n}% ```\n\noutput\n```(âŽˆ|aihub-sandbox:N/A)abhinavkhanna@YL4Q5M7D76-Abhinav-Khanna nginx-cert % k -n insan-use2-aihub-sandbox-instabase logs gcloud-test\nUpdated property [core/project].\n\nAuthenticated with external account credentials for: [<principal://iam.googleapis.com/projects/666216188190/locations/global/workloadIdentityPools/instabase-dev-vertex-ai-pool/subject/system:serviceaccount:insan-use2-aihub-sandbox-instabase:api-server-sa>].\nYour current project is [instabase-dev].  You can change this setting by running:\n  $ gcloud config set project PROJECT_ID\n                                                                                             Credentialed Accounts\nACTIVE  ACCOUNT\n*       <principal://iam.googleapis.com/projects/666216188190/locations/global/workloadIdentityPools/instabase-dev-vertex-ai-pool/subject/system:serviceaccount:insan-use2-aihub-sandbox-instabase:api-server-sa>\n\nTo set the active account, run:\n    $ gcloud config set account `ACCOUNT````",
      "time": "15:02",
      "timestamp": "1754949720.694169",
      "is_reply": true
    },
    {
      "sender": "Anil",
      "user_id": "U01BH8XBR55",
      "message": "@Abhinav can I setup some time with you now or tomorrow to set this up in aihub-sandbox?",
      "time": "15:25",
      "timestamp": "1754951103.343639",
      "is_reply": true
    },
    {
      "sender": "Abhinav",
      "user_id": "U03V2G5L19A",
      "message": "Sure",
      "time": "15:25",
      "timestamp": "1754951116.659689",
      "is_reply": true
    },
    {
      "sender": "Anil",
      "user_id": "U01BH8XBR55",
      "message": "are you free to do it now or tomorrow?",
      "time": "15:25",
      "timestamp": "1754951127.747959",
      "is_reply": true
    },
    {
      "sender": "Abhinav",
      "user_id": "U03V2G5L19A",
      "message": "Lets do Tomorrow",
      "time": "15:25",
      "timestamp": "1754951153.244239",
      "is_reply": true
    },
    {
      "sender": "Anil",
      "user_id": "U01BH8XBR55",
      "message": "cool - will send cal invite",
      "time": "15:25",
      "timestamp": "1754951159.112789",
      "is_reply": true
    }
  ],
  "metadata": {
    "channel_id": "C06FA6A23",
    "channel_name": "discuss-engineering",
    "date_file": "2025-08-11.json",
    "message_count": 29,
    "start_time": "1754929319.500969",
    "end_time": "1754951159.112789",
    "is_thread": true
  }
}