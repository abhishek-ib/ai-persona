{
  "id": "ch_C05L87V014J_2025-01-06_1736203438.905309_thread",
  "type": "channel",
  "channel_name": "ask-crafting",
  "conversation_type": "thread",
  "participants": [
    "Yash Botadra",
    "mfichman",
    "Heymian"
  ],
  "messages": [
    {
      "sender": "Yash Botadra",
      "user_id": "U02QEPQ1M7U",
      "message": "Hi team,\nHas anyone managed to get their storage issues fixed while the sandbox is suspended?\nThe dev workspace on my sandbox (link (https://instabase.sandboxes.site/sandboxes/yashb-dev?cw=dev)) has run out of storage. It is in a “suspended” state. Reviving it fails. Resyncing with “Force Update Base” also doesn’t help. Anything else I can try?",
      "time": "14:43",
      "timestamp": "1736203438.905309",
      "is_reply": false
    },
    {
      "sender": "mfichman",
      "user_id": "U03DZ9XUE10",
      "message": "Yash, can you do a complete rebuild? Note that this will kill any files you have saved under $HOME though.",
      "time": "15:03",
      "timestamp": "1736204621.348829",
      "is_reply": true
    },
    {
      "sender": "mfichman",
      "user_id": "U03DZ9XUE10",
      "message": "But it also nukes the whole FS, which should get it unstuck.",
      "time": "15:04",
      "timestamp": "1736204641.561789",
      "is_reply": true
    },
    {
      "sender": "Yash Botadra",
      "user_id": "U02QEPQ1M7U",
      "message": "Yeah, I was hoping there would be a less destructive way. Sounds like there is isn’t.\nI’ll do this then. Thanks!",
      "time": "15:05",
      "timestamp": "1736204718.412839",
      "is_reply": true
    },
    {
      "sender": "mfichman",
      "user_id": "U03DZ9XUE10",
      "message": "BTW, you may be able to snapshot the sandbox while it's off -- that way you can at least save your $HOME. We can also ask the Crafting folks how to recover it.",
      "time": "15:05",
      "timestamp": "1736204754.658319",
      "is_reply": true
    },
    {
      "sender": "Yash Botadra",
      "user_id": "U02QEPQ1M7U",
      "message": "That would be golden!",
      "time": "15:06",
      "timestamp": "1736204777.719689",
      "is_reply": true
    },
    {
      "sender": "Yash Botadra",
      "user_id": "U02QEPQ1M7U",
      "message": "Found this: https://docs.sandboxes.cloud/docs/data-snapshots",
      "time": "15:08",
      "timestamp": "1736204900.786919",
      "is_reply": true
    },
    {
      "sender": "mfichman",
      "user_id": "U03DZ9XUE10",
      "message": "You can run `cs snapshot` from your laptop I think",
      "time": "15:08",
      "timestamp": "1736204914.965299",
      "is_reply": true
    },
    {
      "sender": "mfichman",
      "user_id": "U03DZ9XUE10",
      "message": "`cs snapshot create` should work",
      "time": "15:09",
      "timestamp": "1736204958.107089",
      "is_reply": true
    },
    {
      "sender": "mfichman",
      "user_id": "U03DZ9XUE10",
      "message": "Or `cs snapshot create --home`",
      "time": "15:09",
      "timestamp": "1736204978.367459",
      "is_reply": true
    },
    {
      "sender": "mfichman",
      "user_id": "U03DZ9XUE10",
      "message": "Maybe do both just in case :laughing:",
      "time": "15:10",
      "timestamp": "1736205007.552789",
      "is_reply": true
    },
    {
      "sender": "Yash Botadra",
      "user_id": "U02QEPQ1M7U",
      "message": "Just tried. Doesn’t work when the WS is not ready :disappointed:\nEven the UI is missing that option",
      "time": "15:11",
      "timestamp": "1736205067.769469",
      "is_reply": true
    },
    {
      "sender": "mfichman",
      "user_id": "U03DZ9XUE10",
      "message": "Ah bummer :disappointed:",
      "time": "15:11",
      "timestamp": "1736205072.689329",
      "is_reply": true
    },
    {
      "sender": "mfichman",
      "user_id": "U03DZ9XUE10",
      "message": "Want me to ask the crafting folks? Can you send a link to the sandbox too?",
      "time": "15:11",
      "timestamp": "1736205085.530949",
      "is_reply": true
    },
    {
      "sender": "Yash Botadra",
      "user_id": "U02QEPQ1M7U",
      "message": "Sure. The link is in my post. Here it is again: https://instabase.sandboxes.site/sandboxes/yashb-dev",
      "time": "15:11",
      "timestamp": "1736205111.504059",
      "is_reply": true
    },
    {
      "sender": "mfichman",
      "user_id": "U03DZ9XUE10",
      "message": "Oops, sorry. OK, I'll send it to them",
      "time": "15:12",
      "timestamp": "1736205137.443749",
      "is_reply": true
    },
    {
      "sender": "mfichman",
      "user_id": "U03DZ9XUE10",
      "message": "As an aside...should I add a background job that runs `docker system prune` once a week or so? I think that may help avoid this. Usually, it's old docker images that cause the disk space to run out.",
      "time": "15:16",
      "timestamp": "1736205361.314819",
      "is_reply": true
    },
    {
      "sender": "Yash Botadra",
      "user_id": "U02QEPQ1M7U",
      "message": "Haha I was going to try setting up a cron on my sandbox for a few days to see if it helps before suggesting.\nShouldn’t hurt to have it right away, I guess :slightly_smiling_face:",
      "time": "15:18",
      "timestamp": "1736205481.262829",
      "is_reply": true
    },
    {
      "sender": "Heymian",
      "user_id": "UADQ9V8PK",
      "message": "I have to run docker system prune daily, and I still run out of space very shortly after running it.",
      "time": "15:18",
      "timestamp": "1736205513.860289",
      "is_reply": true
    },
    {
      "sender": "Heymian",
      "user_id": "UADQ9V8PK",
      "message": "Can we update the template to give everyone more space?",
      "time": "15:19",
      "timestamp": "1736205549.154469",
      "is_reply": true
    },
    {
      "sender": "Yash Botadra",
      "user_id": "U02QEPQ1M7U",
      "message": "Daily? :open_mouth:\nI think one or more services must be failing to build in your sandbox so it keeps trying to build new images repeatedly.",
      "time": "15:22",
      "timestamp": "1736205721.497429",
      "is_reply": true
    },
    {
      "sender": "Heymian",
      "user_id": "UADQ9V8PK",
      "message": "ohh hrm, everything looks green",
      "time": "15:35",
      "timestamp": "1736206558.255709",
      "is_reply": true
    },
    {
      "sender": "mfichman",
      "user_id": "U03DZ9XUE10",
      "message": "Looks like the sandbox is back up now?",
      "time": "15:39",
      "timestamp": "1736206745.686479",
      "is_reply": true
    },
    {
      "sender": "mfichman",
      "user_id": "U03DZ9XUE10",
      "message": "After you reset it, I assume?",
      "time": "15:39",
      "timestamp": "1736206754.504849",
      "is_reply": true
    },
    {
      "sender": "mfichman",
      "user_id": "U03DZ9XUE10",
      "message": "All the services seem good now. I think disk space was the only issue.",
      "time": "15:39",
      "timestamp": "1736206775.782189",
      "is_reply": true
    },
    {
      "sender": "mfichman",
      "user_id": "U03DZ9XUE10",
      "message": ">  Daily?\nYeah, I wonder if my decision to auto-build the docker images and auto-start the services is a good one. Maybe I should change it so that folks have to explicitly rebuild the service image(s) instead of implicitly building them whenever the service restarts.",
      "time": "15:40",
      "timestamp": "1736206843.577819",
      "is_reply": true
    },
    {
      "sender": "mfichman",
      "user_id": "U03DZ9XUE10",
      "message": "Also questioning whether services should auto-start, since some people use the sandboxes and don't want services running.",
      "time": "15:41",
      "timestamp": "1736206868.692039",
      "is_reply": true
    },
    {
      "sender": "Yash Botadra",
      "user_id": "U02QEPQ1M7U",
      "message": "Yup all good on my sandbox after rebuilding the workspace.",
      "time": "15:43",
      "timestamp": "1736206993.187029",
      "is_reply": true
    },
    {
      "sender": "Heymian",
      "user_id": "UADQ9V8PK",
      "message": "I'm out of disk space I just ran docker system prune an hour ago and cleared out my tmp dir. Any other ideas?\noutput of ncdu:\n```   16.5 GiB [##########] /home\n    9.8 GiB [#####     ] /usr\n. 539.6 MiB [          ] /var\n. 512.0 MiB [          ] /opt\n. 367.4 MiB [          ] /tmp\n.   4.8 MiB [          ] /etc\n.  68.0 KiB [          ] /run\n   16.0 KiB [          ] /private\n    0.0   B [          ] /dev\n!   0.0   B [          ] /root\n@   0.0   B [          ]  libx32\n@   0.0   B [          ]  lib64\n@   0.0   B [          ]  lib32\n@   0.0   B [          ]  sbin\n@   0.0   B [          ]  lib\n@   0.0   B [          ]  bin\ne   0.0   B [          ] /srv\ne   0.0   B [          ] /mnt\ne   0.0   B [          ] /media\ne   0.0   B [          ] /boot\n^   0.0   B [          ] /sys\n^   0.0   B [          ] /proc\n Total disk usage:  27.7 GiB  Apparent size:  25.3 GiB  Items: 1110961```",
      "time": "15:45",
      "timestamp": "1736207104.572909",
      "is_reply": true
    },
    {
      "sender": "mfichman",
      "user_id": "U03DZ9XUE10",
      "message": "Huh, interesting",
      "time": "15:45",
      "timestamp": "1736207136.432389",
      "is_reply": true
    },
    {
      "sender": "mfichman",
      "user_id": "U03DZ9XUE10",
      "message": "So, one thing that someone ran into (I forget who) is that `/var/lib/docker` was full, but `docker system prune` didn't clean it up. Can you check how big that dir is? It's on a different mount point, so I think you have to do\n\n```ncdu /var/lib/docker/```",
      "time": "15:46",
      "timestamp": "1736207187.209539",
      "is_reply": true
    },
    {
      "sender": "mfichman",
      "user_id": "U03DZ9XUE10",
      "message": "You can also reset like Yash did, with the caveat that you lose what's in $HOME I think",
      "time": "15:46",
      "timestamp": "1736207206.840009",
      "is_reply": true
    },
    {
      "sender": "Heymian",
      "user_id": "UADQ9V8PK",
      "message": "I did a reset (new sandbox) over the holidays, and the disk issue came back pretty quickly after that. Does a reset do something different from a new sandbox?",
      "time": "15:47",
      "timestamp": "1736207242.620199",
      "is_reply": true
    },
    {
      "sender": "Heymian",
      "user_id": "UADQ9V8PK",
      "message": "I'm not as stuck as Yash, I'm actually ssh-ed into the sandbox, I just can't run any git commands.",
      "time": "15:48",
      "timestamp": "1736207281.081769",
      "is_reply": true
    },
    {
      "sender": "mfichman",
      "user_id": "U03DZ9XUE10",
      "message": "Try \"refresh base image\" in your case @Heymian. It will wipe everything except $HOME, which should free a lot of space.",
      "time": "15:48",
      "timestamp": "1736207303.230949",
      "is_reply": true
    },
    {
      "sender": "mfichman",
      "user_id": "U03DZ9XUE10",
      "message": "",
      "time": "15:48",
      "timestamp": "1736207313.184589",
      "is_reply": true
    },
    {
      "sender": "mfichman",
      "user_id": "U03DZ9XUE10",
      "message": "",
      "time": "15:48",
      "timestamp": "1736207323.764129",
      "is_reply": true
    },
    {
      "sender": "Yash Botadra",
      "user_id": "U02QEPQ1M7U",
      "message": "For reference, here’s the ncdu output after a fresh workspace reset:\n```   17.3 GiB [##########] /home\n    9.5 GiB [#####     ] /usr\n. 512.0 MiB [          ] /opt\n. 125.9 MiB [          ] /var\n.   4.8 MiB [          ] /etc\n    2.3 MiB [          ] /tmp\n.  68.0 KiB [          ] /run\n   16.0 KiB [          ] /private\n    0.0   B [          ] /sys\n.   0.0   B [          ] /proc\n    0.0   B [          ] /dev\n!   0.0   B [          ] /root\n@   0.0   B [          ]  libx32\n@   0.0   B [          ]  lib64\n@   0.0   B [          ]  lib32\n@   0.0   B [          ]  sbin\n@   0.0   B [          ]  lib\n@   0.0   B [          ]  bin\ne   0.0   B [          ] /srv\ne   0.0   B [          ] /mnt\ne   0.0   B [          ] /media\ne   0.0   B [          ] /boot\nTotal disk usage:  27.4 GiB  Apparent size:  25.1 GiB  Items: 1596347```\nPretty similar to Heymian’s",
      "time": "15:50",
      "timestamp": "1736207401.281079",
      "is_reply": true
    },
    {
      "sender": "mfichman",
      "user_id": "U03DZ9XUE10",
      "message": "Yeah, odd. Something is not getting included in the ncdu output",
      "time": "15:51",
      "timestamp": "1736207483.084639",
      "is_reply": true
    },
    {
      "sender": "Heymian",
      "user_id": "UADQ9V8PK",
      "message": "```--- /var/lib/docker --------------------------------------------------------------------------------------------------------------------------------------------------------------------------\n. 430.2 GiB [##########] /containerd\n    5.1 GiB [          ] /rootfs\n    2.9 GiB [          ] /buildkit\n    1.6 GiB [          ] /volumes\n  103.0 MiB [          ] /overlay2\n    4.1 MiB [          ] /containers\n  924.0 KiB [          ] /image\n  128.0 KiB [          ] /network\n   16.0 KiB [          ] /plugins\ne   4.0 KiB [          ] /tmp\ne   4.0 KiB [          ] /swarm\ne   4.0 KiB [          ] /runtimes\n    4.0 KiB [          ]  engine-id\nTotal disk usage: 439.8 GiB  Apparent size: 432.4 GiB  Items: 3474127```",
      "time": "15:59",
      "timestamp": "1736207992.024519",
      "is_reply": true
    },
    {
      "sender": "mfichman",
      "user_id": "U03DZ9XUE10",
      "message": "Yeah, this makes more sense.",
      "time": "16:20",
      "timestamp": "1736209250.253429",
      "is_reply": true
    },
    {
      "sender": "mfichman",
      "user_id": "U03DZ9XUE10",
      "message": "Containerd is where the images are usually. Resetting the workspace as above will fix this.",
      "time": "16:22",
      "timestamp": "1736209330.119749",
      "is_reply": true
    },
    {
      "sender": "Heymian",
      "user_id": "UADQ9V8PK",
      "message": "After resetting, the sandbox seems to be in a borked state. https://instabase.sandboxes.site/sandboxes/heymian1?cw=dev I did delete my other sandbox `heymian` earlier today as well, not sure if that would cause issues with this one. Any ideas how to fix it?",
      "time": "21:08",
      "timestamp": "1736226529.311039",
      "is_reply": true
    }
  ],
  "metadata": {
    "channel_id": "C05L87V014J",
    "channel_name": "ask-crafting",
    "date_file": "2025-01-06.json",
    "message_count": 43,
    "start_time": "1736203438.905309",
    "end_time": "1736226529.311039",
    "is_thread": true
  }
}