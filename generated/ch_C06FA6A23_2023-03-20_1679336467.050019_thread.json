{
  "id": "ch_C06FA6A23_2023-03-20_1679336467.050019_thread",
  "type": "channel",
  "channel_name": "discuss-engineering",
  "conversation_type": "thread",
  "participants": [
    "Xi Cheng",
    "Xindi Xu",
    "youngmok.cho",
    "Pridhvi Vegesna"
  ],
  "messages": [
    {
      "sender": "Xindi Xu",
      "user_id": "U03FT35MAHF",
      "message": "Does anyone see issues with running api-server in the latest master? It is complaining that it can't find `opencensus.ext`",
      "time": "11:21",
      "timestamp": "1679336467.050019",
      "is_reply": false
    },
    {
      "sender": "Xindi Xu",
      "user_id": "U03FT35MAHF",
      "message": "```➜  api-server git:(CS-2785-ib-user-select-migrate-to-combo-box-testing) ✗ make runlocal\nMakefile:102: warning: overriding commands for target `run-test-local'\n/Users/xindixu/Code/instabase/webserver/api-server/../../shared-utils/build-utils/shared/build-python.mk:193: warning: ignoring old commands for target `run-test-local'\nmkdir -p /Users/xindixu/Code/instabase/webserver/api-server/tmp\npython /Users/xindixu/Code/instabase/webserver/api-server/../../shared-utils/build-utils/stack-local/get-env-local.py \\\n\t/Users/xindixu/Code/instabase/webserver/api-server/deployment/env/deployment-config.json \\\n\t/Users/xindixu/Code/instabase/webserver/api-server/../../shared-utils/build-utils/shared/env-local.json \\\n\t/Users/xindixu/Code/instabase/webserver/api-server/deployment/local/docker-env.json > /Users/xindixu/Code/instabase/webserver/api-server/tmp/env_local\necho \"export LEGACY=''\" >> /Users/xindixu/Code/instabase/webserver/api-server/tmp/env_local\npoetry env use $(pyenv root)/versions/$(grep 'python =' pyproject.toml | cut -d '\"' -f 2)/bin/python && poetry install\nUsing virtualenv: /Users/xindixu/Library/Caches/pypoetry/virtualenvs/api-server-6qStoZeK-py3.9\nInstalling dependencies from lock file\n\nPackage operations: 0 installs, 1 update, 0 removals\n\n  • Updating opencensus-ext-prometheus (0.2.1 -> 0.3.dev0 ec72cd3)\ncd /Users/xindixu/Code/instabase/webserver/api-server/build/py && poetry run /bin/bash start-local.sh\nError: While importing 'manage_api_server_apps', an ImportError was raised:\n\nTraceback (most recent call last):\n  File \"/Users/xindixu/Library/Caches/pypoetry/virtualenvs/api-server-6qStoZeK-py3.9/lib/python3.9/site-packages/flask/cli.py\", line 234, in locate_app\n    __import__(module_name)\n  File \"/Users/xindixu/Code/instabase/webserver/api-server/build/py/manage_api_server_apps.py\", line 36, in <module>\n    from instabase.metrics_utils.automation_metrics_util import init_automation_metrics_export\n  File \"/Users/xindixu/Code/instabase/webserver/api-server/build/py/instabase/metrics_utils/automation_metrics_util.py\", line 12, in <module>\n    from instabase.flow_correction.result_types import ErrorType\n  File \"/Users/xindixu/Code/instabase/webserver/api-server/build/py/instabase/flow_correction/result_types.py\", line 10, in <module>\n    from instabase.flow_correction.data_quality import DataQualityResult\n  File \"/Users/xindixu/Code/instabase/webserver/api-server/build/py/instabase/flow_correction/data_quality.py\", line 6, in <module>\n    from instabase.ocr.client.libs.ibocr import ParsedIBOCR\n  File \"/Users/xindixu/Code/instabase/webserver/api-server/build/py/instabase/ocr/client/libs/ibocr.py\", line 17, in <module>\n    from instabase.ocr.client.libs.ibdoc_utils import (\n  File \"/Users/xindixu/Code/instabase/webserver/api-server/build/py/instabase/ocr/client/libs/ibdoc_utils/ibdoc_v2.py\", line 10, in <module>\n    from instabase.content.filehandle import ibfile\n  File \"/Users/xindixu/Code/instabase/webserver/api-server/build/py/instabase/content/filehandle/ibfile.py\", line 25, in <module>\n    from instabase.utils.rpc.file_client import (\n  File \"/Users/xindixu/Code/instabase/webserver/api-server/build/py/instabase/utils/rpc/file_client.py\", line 19, in <module>\n    from instabase.utils.rpc.client import ThriftClient\n  File \"/Users/xindixu/Code/instabase/webserver/api-server/build/py/instabase/utils/rpc/client.py\", line 14, in <module>\n    from instabase.utils.rpc.pool import Client\n  File \"/Users/xindixu/Code/instabase/webserver/api-server/build/py/instabase/utils/rpc/pool.py\", line 15, in <module>\n    import instabase.stats.thrift as thrift_stats\n  File \"/Users/xindixu/Code/instabase/webserver/api-server/build/py/instabase/stats/thrift/__init__.py\", line 4, in <module>\n    from instabase.stats.api import StatsExporter\n  File \"/Users/xindixu/Code/instabase/webserver/api-server/build/py/instabase/stats/api.py\", line 16, in <module>\n    from instabase.stats.agent.opencensus import OCAgent\n  File \"/Users/xindixu/Code/instabase/webserver/api-server/build/py/instabase/stats/agent/opencensus.py\", line 16, in <module>\n    from opencensus.ext.prometheus import stats_exporter as prometheus  # type: ignore\nModuleNotFoundError: No module named 'opencensus.ext'\n\n\nUsage: flask [OPTIONS] COMMAND [ARGS]...\nTry 'flask --help' for help.\n\nError: No such command 'gevent_server'.\nmake: *** [runlocal] Error 2```",
      "time": "11:21",
      "timestamp": "1679336484.515169",
      "is_reply": true
    },
    {
      "sender": "Xindi Xu",
      "user_id": "U03FT35MAHF",
      "message": "I had a ugly fix here (https://instabase.slack.com/archives/C039JKRCE2H/p1678745692248229?thread_ts=1678721672.330949&cid=C039JKRCE2H) but it stops working after I pull the latest master",
      "time": "11:21",
      "timestamp": "1679336510.058519",
      "is_reply": true
    },
    {
      "sender": "Pridhvi Vegesna",
      "user_id": "U0290LSE8KC",
      "message": "On my phone so this is a blind guess, try commenting out the line in the .toml file which installs opencensus-ext-Prometheus and then manually run the same poetry add opencensus command",
      "time": "11:23",
      "timestamp": "1679336598.455149",
      "is_reply": true
    },
    {
      "sender": "Xindi Xu",
      "user_id": "U03FT35MAHF",
      "message": "Still not working :disappointed:",
      "time": "11:35",
      "timestamp": "1679337313.771519",
      "is_reply": true
    },
    {
      "sender": "Xindi Xu",
      "user_id": "U03FT35MAHF",
      "message": "I've also tried removing poetry venv",
      "time": "11:35",
      "timestamp": "1679337337.668219",
      "is_reply": true
    },
    {
      "sender": "Xindi Xu",
      "user_id": "U03FT35MAHF",
      "message": "Thanks everyone for the help! Updating poetry to `1.4.1` and rebuilding everything from scratch works!",
      "time": "12:04",
      "timestamp": "1679339053.975609",
      "is_reply": true
    },
    {
      "sender": "Xindi Xu",
      "user_id": "U03FT35MAHF",
      "message": "Try these steps if you are seeing the same error:\n1. pull latest master\n2. In api-server, webapp, or apps-server, run `poetry self update 1.4.1`\n3. In api-server, webapp, and apps-server, run `make clean`, `make build runlocal`",
      "time": "12:07",
      "timestamp": "1679339270.894649",
      "is_reply": true
    },
    {
      "sender": "youngmok.cho",
      "user_id": "U03T0BUUHTQ",
      "message": "^ This is only for local setup. The fix for the `opencensus.ext` error in CI is coming in shortly.",
      "time": "12:26",
      "timestamp": "1679340376.873329",
      "is_reply": true
    },
    {
      "sender": "Xi Cheng",
      "user_id": "U01F946DGEP",
      "message": "```poetry self update 1.4.1\nUpdating Poetry version ...\n\n\nUpdating dependencies\nResolving dependencies... (14.2s)\n\n(\"Connection broken: FileNotFoundError(2, 'No such file or directory')\", FileNotFoundError(2, 'No such file or directory'))```\nNot sure why",
      "time": "12:26",
      "timestamp": "1679340382.847689",
      "is_reply": true
    },
    {
      "sender": "Xindi Xu",
      "user_id": "U03FT35MAHF",
      "message": "Where did you run this?",
      "time": "12:26",
      "timestamp": "1679340414.701469",
      "is_reply": true
    },
    {
      "sender": "Xi Cheng",
      "user_id": "U01F946DGEP",
      "message": "```instabase/webserver/api-server```",
      "time": "12:27",
      "timestamp": "1679340427.745069",
      "is_reply": true
    },
    {
      "sender": "Xi Cheng",
      "user_id": "U01F946DGEP",
      "message": "I am facing issues with permissions, and was advised to do the upgrade",
      "time": "12:27",
      "timestamp": "1679340442.529979",
      "is_reply": true
    },
    {
      "sender": "Xindi Xu",
      "user_id": "U03FT35MAHF",
      "message": "Maybe also try `poetry env remove --all`",
      "time": "12:27",
      "timestamp": "1679340463.756529",
      "is_reply": true
    },
    {
      "sender": "Xi Cheng",
      "user_id": "U01F946DGEP",
      "message": "same error :slightly_smiling_face:",
      "time": "12:28",
      "timestamp": "1679340508.071849",
      "is_reply": true
    }
  ],
  "metadata": {
    "channel_id": "C06FA6A23",
    "channel_name": "discuss-engineering",
    "date_file": "2023-03-20.json",
    "message_count": 15,
    "start_time": "1679336467.050019",
    "end_time": "1679340508.071849",
    "is_thread": true
  }
}